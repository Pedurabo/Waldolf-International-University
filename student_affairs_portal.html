<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Affairs Portal - Waldorf Colleges & Universities</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c5530;
        }

        .nav-actions {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: #2c5530;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #1e3a21;
            transform: translateY(-2px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .welcome-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .welcome-title {
            font-size: 2.5em;
            color: #2c5530;
            margin-bottom: 15px;
        }

        .welcome-subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 25px;
        }

        .office-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        .office-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
        }

        .office-details h3 {
            color: #2c5530;
            margin-bottom: 5px;
        }

        .office-details p {
            color: #666;
            line-height: 1.6;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-icon {
            font-size: 1.5em;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c5530;
            flex: 1;
        }

        .notification-badge {
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }

        .sofia-messages {
            max-height: 400px;
            overflow-y: auto;
        }

        .message-item {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #2c5530;
        }

        .message-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }

        .message-item.unread {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-sender {
            font-weight: 600;
            color: #2c5530;
        }

        .message-time {
            font-size: 0.9em;
            color: #666;
        }

        .message-subject {
            font-weight: 500;
            margin-bottom: 5px;
            color: #333;
        }

        .message-preview {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }

        .student-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .student-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
            transition: all 0.3s ease;
        }

        .student-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .student-card.pending {
            border-left-color: #ffc107;
            background: #fff8e1;
        }

        .student-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .student-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #2c5530;
        }

        .student-id {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.9em;
            color: #666;
        }

        .student-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .detail-item {
            font-size: 0.9em;
            color: #666;
        }

        .detail-label {
            font-weight: 500;
            color: #333;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .student-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c5530;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .quick-action {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .quick-action:hover {
            background: #2c5530;
            color: white;
            transform: translateY(-3px);
        }

        .quick-action-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 3% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3em;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-actions {
            padding: 20px 30px;
            background: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            border-top: 1px solid #dee2e6;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); background-color: #ff6b6b; }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .student-details {
                grid-template-columns: 1fr;
            }
            
            .stats-grid, .quick-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">🏛️ Student Affairs Portal</div>
            <div class="nav-actions">
                <a href="student_management.html" class="nav-btn">🤖 Sofia's Portal</a>
                <a href="waldorf_chrome.html" class="nav-btn">← Main Dashboard</a>
                <button class="nav-btn" onclick="showHelp()">Help</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <h1 class="welcome-title">🏛️ Student Affairs Office</h1>
            <p class="welcome-subtitle">Student Enrollment Management & Communication Hub</p>
            
            <div class="office-info">
                <div class="office-avatar">👥</div>
                <div class="office-details">
                    <h3>Student Affairs Team</h3>
                    <p>Managing student enrollment, communications, and academic services coordination. 
                       Working directly with Sofia AI to streamline the student registration and activation process.</p>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Left Sidebar - Sofia Communications -->
            <div class="sidebar-left">
                <!-- Sofia Messages -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">🤖</div>
                        <div class="card-title">Sofia's Messages</div>
                        <div class="notification-badge" id="sofiaMessagesBadge">2</div>
                    </div>
                    <div class="sofia-messages" id="sofiaMessagesList">
                        <!-- Sofia messages will be loaded here -->
                    </div>
                </div>

                <!-- Quick Statistics -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">📊</div>
                        <div class="card-title">Today's Stats</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="newRegistrations">8</div>
                            <div class="stat-label">New Registrations</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="credentialsSent">12</div>
                            <div class="stat-label">Credentials Sent</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="pendingActivations">5</div>
                            <div class="stat-label">Pending Actions</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="activatedToday">15</div>
                            <div class="stat-label">Activated Today</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content - Student Management -->
            <div class="main-content">
                <!-- Active Students -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">✅</div>
                        <div class="card-title">Recently Activated Students</div>
                    </div>
                    <div class="student-list" id="activeStudentsList">
                        <!-- Active students will be loaded here -->
                    </div>
                </div>

                <!-- Pending Actions -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">⏳</div>
                        <div class="card-title">Students Awaiting Credentials</div>
                    </div>
                    <div class="student-list" id="pendingStudentsList">
                        <!-- Pending students will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Right Sidebar - Quick Actions -->
            <div class="sidebar-right">
                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">⚡</div>
                        <div class="card-title">Quick Actions</div>
                    </div>
                    <div class="quick-actions">
                        <div class="quick-action" onclick="composeEmail()">
                            <div class="quick-action-icon">📧</div>
                            <div>Compose Email</div>
                        </div>
                        <div class="quick-action" onclick="bulkCredentials()">
                            <div class="quick-action-icon">📋</div>
                            <div>Bulk Send</div>
                        </div>
                        <div class="quick-action" onclick="generateReport()">
                            <div class="quick-action-icon">📈</div>
                            <div>Daily Report</div>
                        </div>
                        <div class="quick-action" onclick="contactSofia()">
                            <div class="quick-action-icon">🤖</div>
                            <div>Contact Sofia</div>
                        </div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">💡</div>
                        <div class="card-title">System Status</div>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3em; margin-bottom: 15px;">🟢</div>
                        <p style="color: #28a745; font-weight: 600; margin-bottom: 10px;">All Systems Operational</p>
                        <p style="color: #666; font-size: 0.9em; line-height: 1.6;">
                            Sofia AI integration: Active<br>
                            Email service: Online<br>
                            Student portal: Available<br>
                            Last sync: 2 minutes ago
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Detail Modal -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="messageModalTitle">Message Details</h2>
                <button class="close-btn" onclick="closeMessageModal()">&times;</button>
            </div>
            <div class="modal-body" id="messageModalBody">
                <!-- Message content will be loaded here -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="forwardCredentials()">Forward to Student</button>
                <button class="btn btn-warning" onclick="markAsRead()">Mark as Read</button>
            </div>
        </div>
    </div>

    <script>
        // Sync with Sofia's student management data
        let sofiaMessages = [];
        let activeStudents = [];
        let pendingStudents = [];
        let currentMessage = null;

        // Load data from Sofia's system (real-time sync via localStorage)
        function loadSofiaData() {
            // Load real data from Sofia's student management system
            sofiaMessages = JSON.parse(localStorage.getItem('sofiaMessages') || '[]');
            activeStudents = JSON.parse(localStorage.getItem('studentAffairsActiveStudents') || '[]');
            
            // Load statistics from Sofia's system
            const stats = JSON.parse(localStorage.getItem('studentAffairsStats') || '{}');
            if (stats.lastUpdate) {
                document.getElementById('newRegistrations').textContent = stats.newRegistrations || 0;
                document.getElementById('credentialsSent').textContent = stats.credentialsSent || 0;
                document.getElementById('pendingActivations').textContent = stats.pendingActivations || 0;
                document.getElementById('activatedToday').textContent = stats.activatedToday || 0;
            }
            
            // If no real data exists, use sample data for demonstration
            if (sofiaMessages.length === 0) {
                initializeSampleData();
            }
        }

        function initializeSampleData() {
            sofiaMessages = [
                {
                    id: 1,
                    sender: 'Sofia AI - Student Management',
                    subject: '✅ Student Account Activated - Michael Rodriguez (WU011)',
                    preview: 'Account activated for Michael Rodriguez. Student can now login and change credentials...',
                    time: '5 minutes ago',
                    read: false,
                    studentData: {
                        id: 'WU011',
                        name: 'Michael Rodriguez',
                        email: 'michael.rodriguez@student.waldorf.edu',
                        major: 'Computer Science',
                        credentials: {
                            username: 'wu011',
                            tempPassword: 'BlueThunder42'
                        }
                    },
                    fullMessage: `Dear Student Affairs Team,

I have successfully processed and activated a new student account:

📋 STUDENT INFORMATION:
• Name: Michael Rodriguez
• Student ID: WU011
• Email: michael.rodriguez@student.waldorf.edu
• Major: Computer Science
• Academic Year: Year 1
• Status: ACTIVE

🔐 LOGIN CREDENTIALS:
• Username: wu011
• Temporary Password: BlueThunder42
• Portal URL: https://portal.waldorf.edu

📋 NEXT STEPS:
1. Please forward these login credentials to the student's email address
2. Inform the student that they MUST change their password on first login
3. The student will have access to all university services

Best regards,
Sofia - AI Student Management Agent`
                },
                {
                    id: 2,
                    sender: 'Sofia AI - Student Management',
                    subject: '✅ Student Account Activated - Sarah Chen (WU012)',
                    preview: 'Account activated for Sarah Chen. Student can now login and change credentials...',
                    time: '15 minutes ago',
                    read: false,
                    studentData: {
                        id: 'WU012',
                        name: 'Sarah Chen',
                        email: 'sarah.chen@student.waldorf.edu',
                        major: 'Mathematics',
                        credentials: {
                            username: 'wu012',
                            tempPassword: 'GreenEagle73'
                        }
                    }
                }
            ];

            activeStudents = [
                {
                    id: 'WU011',
                    name: 'Michael Rodriguez',
                    email: 'michael.rodriguez@student.waldorf.edu',
                    major: 'Computer Science',
                    year: 1,
                    status: 'active',
                    activatedTime: '5 minutes ago',
                    credentialsSent: false
                },
                {
                    id: 'WU012',
                    name: 'Sarah Chen',
                    email: 'sarah.chen@student.waldorf.edu',
                    major: 'Mathematics',
                    year: 1,
                    status: 'active',
                    activatedTime: '15 minutes ago',
                    credentialsSent: false
                }
            ];

            pendingStudents = [
                {
                    id: 'WU013',
                    name: 'David Johnson',
                    email: 'david.johnson@student.waldorf.edu',
                    major: 'Engineering',
                    year: 1,
                    status: 'pending',
                    submitTime: '1 hour ago'
                }
            ];
        }

        // Initialize page
        function initializePage() {
            loadSofiaData();
            renderSofiaMessages();
            renderActiveStudents();
            renderPendingStudents();
            updateStats();
        }

        // Render Sofia's messages
        function renderSofiaMessages() {
            const messagesList = document.getElementById('sofiaMessagesList');
            const badge = document.getElementById('sofiaMessagesBadge');
            
            const unreadCount = sofiaMessages.filter(msg => !msg.read).length;
            badge.textContent = unreadCount;
            
            messagesList.innerHTML = '';
            
            sofiaMessages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message-item ${message.read ? '' : 'unread'}`;
                messageDiv.onclick = () => openMessage(message);
                
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <div class="message-sender">${message.sender}</div>
                        <div class="message-time">${message.time}</div>
                    </div>
                    <div class="message-subject">${message.subject}</div>
                    <div class="message-preview">${message.preview}</div>
                `;
                
                messagesList.appendChild(messageDiv);
            });
        }

        // Render active students
        function renderActiveStudents() {
            const studentsList = document.getElementById('activeStudentsList');
            studentsList.innerHTML = '';
            
            activeStudents.forEach(student => {
                const studentDiv = document.createElement('div');
                studentDiv.className = 'student-card';
                
                studentDiv.innerHTML = `
                    <div class="student-header">
                        <div class="student-name">${student.name}</div>
                        <div class="student-id">${student.id}</div>
                    </div>
                    <div class="student-details">
                        <div class="detail-item">
                            <span class="detail-label">Email:</span> ${student.email}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Major:</span> ${student.major}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Year:</span> ${student.year}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Activated:</span> ${student.activatedTime}
                        </div>
                    </div>
                    <div class="student-actions">
                        <button class="btn btn-success" onclick="sendCredentials('${student.id}')" 
                                ${student.credentialsSent ? 'disabled' : ''}>
                            ${student.credentialsSent ? '✅ Sent' : '📧 Send Credentials'}
                        </button>
                        <button class="btn btn-primary" onclick="viewStudent('${student.id}')">
                            👁️ View Details
                        </button>
                    </div>
                `;
                
                studentsList.appendChild(studentDiv);
            });
        }

        // Render pending students
        function renderPendingStudents() {
            const studentsList = document.getElementById('pendingStudentsList');
            studentsList.innerHTML = '';
            
            pendingStudents.forEach(student => {
                const studentDiv = document.createElement('div');
                studentDiv.className = 'student-card pending';
                
                studentDiv.innerHTML = `
                    <div class="student-header">
                        <div class="student-name">${student.name}</div>
                        <div class="student-id">${student.id}</div>
                    </div>
                    <div class="student-details">
                        <div class="detail-item">
                            <span class="detail-label">Email:</span> ${student.email}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Major:</span> ${student.major}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status:</span> 
                            <span class="status-badge status-pending">Pending</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Submitted:</span> ${student.submitTime}
                        </div>
                    </div>
                    <div class="student-actions">
                        <button class="btn btn-warning" onclick="requestActivation('${student.id}')">
                            📋 Request Sofia Activation
                        </button>
                    </div>
                `;
                
                studentsList.appendChild(studentDiv);
            });
        }

        // Update statistics
        function updateStats() {
            // These would be calculated from real data
            document.getElementById('newRegistrations').textContent = sofiaMessages.length;
            document.getElementById('credentialsSent').textContent = activeStudents.filter(s => s.credentialsSent).length;
            document.getElementById('pendingActivations').textContent = pendingStudents.length;
            document.getElementById('activatedToday').textContent = activeStudents.length;
        }

        // Open message detail modal
        function openMessage(message) {
            currentMessage = message;
            const modal = document.getElementById('messageModal');
            const title = document.getElementById('messageModalTitle');
            const body = document.getElementById('messageModalBody');
            
            title.textContent = message.subject;
            
            if (message.studentData) {
                body.innerHTML = `
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="color: #2c5530; margin-bottom: 15px;">🎓 Student Information</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div><strong>Name:</strong> ${message.studentData.name}</div>
                            <div><strong>Student ID:</strong> ${message.studentData.id}</div>
                            <div><strong>Email:</strong> ${message.studentData.email}</div>
                            <div><strong>Major:</strong> ${message.studentData.major}</div>
                        </div>
                    </div>
                    
                    <div style="background: #fff3cd; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="color: #856404; margin-bottom: 15px;">🔐 Login Credentials</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div><strong>Username:</strong> <code>${message.studentData.credentials.username}</code></div>
                            <div><strong>Password:</strong> <code>${message.studentData.credentials.tempPassword}</code></div>
                        </div>
                        <p style="margin-top: 15px; color: #856404; font-size: 0.9em;">
                            ⚠️ Student must change password on first login
                        </p>
                    </div>
                    
                    <div style="background: #e8f5e8; border-radius: 10px; padding: 20px;">
                        <h4 style="color: #155724; margin-bottom: 15px;">📧 Next Steps</h4>
                        <ol style="color: #155724; margin-left: 20px;">
                            <li>Forward login credentials to student's email</li>
                            <li>Include password change instructions</li>
                            <li>Provide portal access information</li>
                            <li>Mark message as processed</li>
                        </ol>
                    </div>
                `;
            } else {
                body.innerHTML = `<pre style="white-space: pre-wrap; line-height: 1.6;">${message.fullMessage || 'No additional details available.'}</pre>`;
            }
            
            modal.style.display = 'block';
        }

        // Close message modal
        function closeMessageModal() {
            document.getElementById('messageModal').style.display = 'none';
            currentMessage = null;
        }

        // Forward credentials to student
        function forwardCredentials() {
            if (!currentMessage || !currentMessage.studentData) return;
            
            const student = currentMessage.studentData;
            
            // Simulate sending email
            alert(`📧 Email Sent Successfully!
            
To: ${student.email}
Subject: Your Waldorf University Account is Ready!

Dear ${student.name},

Your student account has been activated! Here are your login credentials:

🔐 Login Information:
• Portal: https://portal.waldorf.edu
• Username: ${student.credentials.username}
• Temporary Password: ${student.credentials.tempPassword}

⚠️ IMPORTANT: You must change your password on first login for security.

Welcome to Waldorf Colleges & Universities!

Best regards,
Student Affairs Office`);
            
            // Mark credentials as sent and sync with system
            updateCredentialsSentStatus(student.id, true);
            
            // Mark message as read and sync
            currentMessage.read = true;
            localStorage.setItem('sofiaMessages', JSON.stringify(sofiaMessages));
            
            // Update displays
            renderSofiaMessages();
            renderActiveStudents();
            updateStats();
            
            closeMessageModal();
        }

        // Mark message as read
        function markAsRead() {
            if (currentMessage) {
                currentMessage.read = true;
                renderSofiaMessages();
                closeMessageModal();
            }
        }

        // Send credentials to specific student
        function sendCredentials(studentId) {
            const student = activeStudents.find(s => s.id === studentId);
            const message = sofiaMessages.find(m => m.studentData && m.studentData.id === studentId);
            
            if (student && message) {
                // Set current message and forward
                currentMessage = message;
                forwardCredentials();
            }
        }

        // Sync credentials sent status back to localStorage
        function updateCredentialsSentStatus(studentId, sent = true) {
            // Update local data
            const student = activeStudents.find(s => s.id === studentId);
            if (student) {
                student.credentialsSent = sent;
            }
            
            // Update localStorage
            localStorage.setItem('studentAffairsActiveStudents', JSON.stringify(activeStudents));
            
            // Update statistics
            const stats = JSON.parse(localStorage.getItem('studentAffairsStats') || '{}');
            stats.credentialsSent = activeStudents.filter(s => s.credentialsSent).length;
            stats.lastUpdate = new Date().toISOString();
            localStorage.setItem('studentAffairsStats', JSON.stringify(stats));
        }

        // View student details
        function viewStudent(studentId) {
            const student = activeStudents.find(s => s.id === studentId);
            if (student) {
                alert(`👤 Student Profile: ${student.name}

🆔 Student ID: ${student.id}
📧 Email: ${student.email}
🎓 Major: ${student.major}
📚 Academic Year: ${student.year}
📈 Status: ${student.status.toUpperCase()}
⏰ Activated: ${student.activatedTime}
📧 Credentials Sent: ${student.credentialsSent ? 'Yes' : 'No'}`);
            }
        }

        // Request activation from Sofia
        function requestActivation(studentId) {
            const student = pendingStudents.find(s => s.id === studentId);
            if (student) {
                // Send request to Sofia's system via localStorage
                const activationRequest = {
                    id: student.id,
                    name: student.name,
                    email: student.email,
                    major: student.major,
                    year: student.year,
                    enrollmentDate: new Date().toISOString().split('T')[0],
                    phone: student.phone || '',
                    address: student.address || '',
                    emergencyContact: student.emergencyContact || '',
                    requestTime: new Date().toISOString(),
                    requestedBy: 'Student Affairs Office'
                };
                
                // Add to Sofia's pending requests
                let pendingRequests = JSON.parse(localStorage.getItem('studentAffairsPendingRequests') || '[]');
                pendingRequests.push(activationRequest);
                localStorage.setItem('studentAffairsPendingRequests', JSON.stringify(pendingRequests));
                
                // Remove from local pending list
                const index = pendingStudents.findIndex(s => s.id === studentId);
                if (index > -1) {
                    pendingStudents.splice(index, 1);
                }
                
                // Update displays
                renderPendingStudents();
                
                alert(`📋 Activation Request Sent to Sofia AI

Student: ${student.name} (${student.id})
Email: ${student.email}
Major: ${student.major}

✅ Request has been sent to Sofia's system. Sofia will process this request and send you the login credentials once the account is activated.

You will receive a notification in Sofia's Messages when the activation is complete.`);
            }
        }

        // Quick action functions
        function composeEmail() {
            alert('📧 Email Composer\n\nOpening email composition interface for student communications...');
        }

        function bulkCredentials() {
            const unsentCount = activeStudents.filter(s => !s.credentialsSent).length;
            if (unsentCount > 0) {
                if (confirm(`📋 Bulk Send Credentials\n\nSend login credentials to ${unsentCount} students who haven't received them yet?`)) {
                    activeStudents.forEach(student => {
                        if (!student.credentialsSent) {
                            student.credentialsSent = true;
                        }
                    });
                    renderActiveStudents();
                    updateStats();
                    alert(`✅ Successfully sent credentials to ${unsentCount} students!`);
                }
            } else {
                alert('✅ All active students have already received their credentials.');
            }
        }

        function generateReport() {
            alert('📈 Daily Report Generated\n\nStudent Affairs Daily Summary:\n• New Registrations: 8\n• Credentials Sent: 12\n• Pending Activations: 5\n• Total Active Students: 247');
        }

        function contactSofia() {
            const message = prompt(`🤖 Send Message to Sofia AI

What would you like to ask Sofia about?

Examples:
• "Please activate student John Doe (WU015)"
• "How many students were activated today?"
• "Generate a report for new registrations"
• "Check status of pending activations"

Enter your message:`);
            
            if (message && message.trim()) {
                // Send message to Sofia's system
                const sofiaRequest = {
                    id: Date.now(),
                    from: 'Student Affairs Office',
                    message: message.trim(),
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                };
                
                let sofiaRequests = JSON.parse(localStorage.getItem('sofiaRequests') || '[]');
                sofiaRequests.push(sofiaRequest);
                localStorage.setItem('sofiaRequests', JSON.stringify(sofiaRequests));
                
                // Simulate Sofia's response
                setTimeout(() => {
                    const response = generateSofiaResponse(message);
                    alert(`🤖 Sofia's Response:\n\n${response}`);
                }, 2000);
                
                showNotification('📤 Message sent to Sofia AI. Response incoming...', 'info');
            }
        }

        function generateSofiaResponse(message) {
            const msg = message.toLowerCase();
            
            if (msg.includes('activate') && msg.includes('student')) {
                return `Hello Student Affairs Team! 👋

I've received your activation request. I'll process this immediately and send you the login credentials once the student account is ready.

Expected completion time: 2-3 minutes
You'll receive a notification in my messages section.

Is there anything else I can help you with?

Best regards,
Sofia 🤖`;
            } else if (msg.includes('report') || msg.includes('how many')) {
                const stats = JSON.parse(localStorage.getItem('studentAffairsStats') || '{}');
                return `📊 Daily Statistics Report

Today's Activity:
• New Registrations: ${stats.newRegistrations || 0}
• Credentials Sent: ${stats.credentialsSent || 0}
• Pending Activations: ${stats.pendingActivations || 0}
• Students Activated: ${stats.activatedToday || 0}

Last Updated: ${stats.lastUpdate ? new Date(stats.lastUpdate).toLocaleTimeString() : 'N/A'}

Would you like a detailed breakdown of any specific metric?

Best regards,
Sofia 🤖`;
            } else if (msg.includes('status') || msg.includes('pending')) {
                return `📋 Pending Activations Status

I'm currently monitoring the enrollment workflow and processing requests as they come in.

Current queue status:
• Processing time: 2-3 minutes per student
• System status: ✅ Operational
• Integration: ✅ Connected with Student Affairs

All activation requests are handled automatically. You'll receive notifications for each completed activation.

Best regards,
Sofia 🤖`;
            } else {
                return `Hello! 👋

Thank you for your message. I'm Sofia, your AI assistant for student management.

I can help you with:
• 🎓 Student account activations
• 🔐 Login credential generation
• 📊 Statistics and reporting
• 📋 Enrollment workflow management
• 📧 Communication coordination

I've logged your request and will get back to you with a detailed response shortly.

If this is urgent, please use the "Request Sofia Activation" button for immediate processing.

Best regards,
Sofia 🤖`;
            }
        }

        function showHelp() {
            alert('❓ Student Affairs Portal Help\n\n• Check Sofia\'s messages for new activations\n• Forward login credentials to students\n• Use bulk actions for efficiency\n• Monitor student status and statistics\n• Contact Sofia for assistance');
        }

        // Real-time communication functions
        function checkForSofiaUpdates() {
            const lastCheck = localStorage.getItem('studentAffairsLastCheck');
            const currentTime = new Date().toISOString();
            
            // Check for new Sofia messages
            const newMessages = sofiaMessages.filter(msg => !msg.read && (!lastCheck || msg.time > lastCheck));
            if (newMessages.length > 0) {
                // Show notification for new messages
                showNotification(`📧 ${newMessages.length} new message(s) from Sofia AI`, 'info');
                
                // Update badge with pulse animation
                const badge = document.getElementById('sofiaMessagesBadge');
                if (badge) {
                    badge.style.animation = 'pulse 1s ease-in-out 3';
                }
            }
            
            localStorage.setItem('studentAffairsLastCheck', currentTime);
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#cce5ff'};
                    color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#004085'};
                    border: 1px solid ${type === 'success' ? '#c3e6cb' : type === 'error' ? '#f5c6cb' : '#b3d7ff'};
                    padding: 15px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    max-width: 400px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    gap: 10px;
                ">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: none;
                        border: none;
                        font-size: 1.2em;
                        cursor: pointer;
                        padding: 0;
                        width: 20px;
                        height: 20px;
                    ">&times;</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function syncWithSofia() {
            // This function can be called to force a sync with Sofia's system
            const previousCount = activeStudents.length;
            loadSofiaData();
            
            if (activeStudents.length > previousCount) {
                const newCount = activeStudents.length - previousCount;
                showNotification(`✅ ${newCount} new student activation(s) received from Sofia`, 'success');
            }
            
            renderSofiaMessages();
            renderActiveStudents();
            renderPendingStudents();
            updateStats();
        }

        // Auto-refresh data every 10 seconds for real-time updates
        setInterval(() => {
            const previousData = {
                messages: sofiaMessages.length,
                active: activeStudents.length,
                pending: pendingStudents.length
            };
            
            loadSofiaData();
            checkForSofiaUpdates();
            
            // Only re-render if data has changed
            if (sofiaMessages.length !== previousData.messages) {
                renderSofiaMessages();
            }
            if (activeStudents.length !== previousData.active) {
                renderActiveStudents();
            }
            if (pendingStudents.length !== previousData.pending) {
                renderPendingStudents();
            }
            
            updateStats();
        }, 10000);

        // Initialize page when loaded
        document.addEventListener('DOMContentLoaded', initializePage);

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('messageModal');
            if (event.target == modal) {
                closeMessageModal();
            }
        }
    </script>
</body>
</html> 