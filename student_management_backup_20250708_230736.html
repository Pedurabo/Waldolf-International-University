<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management - Waldorf Universities</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, #2c5530 0%, #3e7b3e 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-brand {
            font-size: 1.5em;
            font-weight: 700;
        }

        .nav-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .welcome-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .welcome-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="white" opacity="0.1"/><circle cx="80" cy="40" r="2" fill="white" opacity="0.1"/><circle cx="40" cy="80" r="2" fill="white" opacity="0.1"/></svg>');
            background-size: 100px 100px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(-100px) translateY(-100px); }
        }

        .welcome-content {
            position: relative;
            z-index: 2;
        }

        .welcome-title {
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 25px;
        }

        .agent-greeting {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            margin: 20px auto;
            max-width: 600px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .agent-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            margin: 0 auto 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .agent-name {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .agent-role {
            font-size: 1em;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .agent-message {
            font-size: 1em;
            line-height: 1.6;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .sidebar-left, .sidebar-right {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .card-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.3em;
            color: #2c5530;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-3px);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c5530;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
            font-weight: 500;
        }

        .student-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .student-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s ease;
        }

        .student-item:hover {
            background: #f8f9fa;
        }

        .student-item:last-child {
            border-bottom: none;
        }

        .student-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 3px;
        }

        .student-details {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .student-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .status-active { background: #d4edda; color: #155724; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-inactive { background: #f8d7da; color: #721c24; }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2c5530 0%, #3e7b3e 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1e3a23 0%, #2c5530 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 85, 48, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #229954 0%, #1e8449 100%);
            transform: translateY(-2px);
        }

        .search-container {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #2c5530;
            box-shadow: 0 0 0 3px rgba(44, 85, 48, 0.1);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .quick-action {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .quick-action:hover {
            border-color: #2c5530;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .quick-action-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #2c5530;
        }

        .quick-action-text {
            font-weight: 600;
            color: #2c3e50;
        }

        .recent-activities {
            max-height: 350px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 15px;
            font-size: 1.2em;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            color: #2c3e50;
            margin-bottom: 3px;
        }

        .activity-time {
            font-size: 0.8em;
            color: #7f8c8d;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        .notification-badge {
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .workflow-badge {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: auto;
        }

        .inbox-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .inbox-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.3s ease;
            position: relative;
        }

        .inbox-item:hover {
            background: #f8f9fa;
        }

        .inbox-item.unread {
            background: #f0f7ff;
            border-left: 4px solid #3498db;
        }

        .inbox-item:last-child {
            border-bottom: none;
        }

        .inbox-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .inbox-sender {
            font-weight: 600;
            color: #2c3e50;
        }

        .inbox-time {
            font-size: 0.8em;
            color: #7f8c8d;
        }

        .inbox-subject {
            font-weight: 600;
            color: #2c5530;
            margin-bottom: 5px;
        }

        .inbox-preview {
            color: #7f8c8d;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .pending-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .pending-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .pending-item:hover {
            box-shadow: 0 5px 15px rgba(255, 234, 167, 0.3);
            transform: translateY(-2px);
        }

        .pending-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .pending-student {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .pending-status {
            background: #f39c12;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .pending-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .pending-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .pending-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-activate {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }

        .btn-activate:hover {
            background: linear-gradient(135deg, #229954 0%, #1e8449 100%);
            transform: translateY(-2px);
        }

        .btn-reject {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-reject:hover {
            background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
            transform: translateY(-2px);
        }

        .btn-details {
            background: #6c757d;
            color: white;
        }

        .btn-details:hover {
            background: #545b62;
        }

        .activation-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .modal-title {
            font-size: 1.5em;
            color: #2c5530;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #2c3e50;
        }

        .credential-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .credential-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .credential-item:last-child {
            border-bottom: none;
        }

        .credential-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .credential-value {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .email-preview {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .email-header {
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .email-field {
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .email-field strong {
            color: #2c3e50;
        }

        .email-body {
            line-height: 1.6;
            color: #495057;
        }

        /* Students Table Modal Styles */
        .students-table-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .table-modal-content {
            background: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 15px;
            width: 95%;
            max-width: 1200px;
            height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: modalSlide 0.3s ease-out;
            display: flex;
            flex-direction: column;
        }

        .table-modal-header {
            background: linear-gradient(135deg, #2c5530 0%, #3e7b3e 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-modal-title {
            font-size: 1.5em;
            font-weight: 600;
        }

        .table-controls {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-search {
            display: flex;
            gap: 15px;
            align-items: center;
            flex: 1;
        }

        .table-search input {
            padding: 10px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            min-width: 250px;
        }

        .table-search input:focus {
            outline: none;
            border-color: #2c5530;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .students-table-container {
            flex: 1;
            overflow: auto;
            padding: 0;
        }

        .students-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .students-table th {
            background: #f8f9fa;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            color: #2c5530;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .students-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }

        .students-table tr:hover {
            background: #f8f9fa;
        }

        .students-table tr.selected {
            background: #e8f5e8;
        }

        .student-avatar-small {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .action-icons {
            display: flex;
            gap: 8px;
        }

        .action-icon {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .action-icon.edit {
            background: #ffc107;
            color: white;
        }

        .action-icon.edit:hover {
            background: #e0a800;
            transform: scale(1.1);
        }

        .action-icon.delete {
            background: #dc3545;
            color: white;
        }

        .action-icon.delete:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        .action-icon.view {
            background: #17a2b8;
            color: white;
        }

        .action-icon.view:hover {
            background: #138496;
            transform: scale(1.1);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-suspended {
            background: #f5c6cb;
            color: #721c24;
        }

        .gpa-badge {
            padding: 4px 8px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            min-width: 45px;
        }

        .gpa-excellent { background: #d4edda; color: #155724; }
        .gpa-good { background: #cce5ff; color: #004085; }
        .gpa-average { background: #fff3cd; color: #856404; }
        .gpa-poor { background: #f8d7da; color: #721c24; }

        .pagination {
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }

        .pagination-info {
            color: #6c757d;
            font-size: 0.9em;
        }

        .pagination-controls {
            display: flex;
            gap: 5px;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            background: white;
            color: #495057;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #2c5530;
            color: white;
            border-color: #2c5530;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: #2c5530;
            color: white;
            border-color: #2c5530;
        }

        /* Student Form Modal */
        .student-form-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }

        .form-modal-content {
            background: white;
            margin: 3% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .form-modal-header {
            background: linear-gradient(135deg, #2c5530 0%, #3e7b3e 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-modal-body {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-grid.full-width {
            grid-template-columns: 1fr;
        }

        .form-group-modal {
            margin-bottom: 20px;
        }

        .form-label-modal {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.9em;
        }

        .form-input-modal {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input-modal:focus {
            outline: none;
            border-color: #2c5530;
            box-shadow: 0 0 0 3px rgba(44, 85, 48, 0.1);
        }

        .form-select-modal {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .form-actions {
            padding: 20px 30px;
            background: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            border-top: 1px solid #dee2e6;
        }

        .bulk-actions {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px 20px;
            margin: 10px 20px;
            border-radius: 8px;
            align-items: center;
            gap: 15px;
        }

        .bulk-actions.show {
            display: flex;
        }

        .bulk-actions-text {
            flex: 1;
            color: #856404;
            font-weight: 600;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); background-color: #ff6b6b; }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .pending-details {
                grid-template-columns: 1fr;
            }

            .pending-actions {
                flex-direction: column;
            }

            .modal-content {
                margin: 2% auto;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">🎓 Student Management Portal</div>
            <div class="nav-actions">
                <a href="waldorf_chrome.html" class="nav-btn">← Back to Main Dashboard</a>
                <button class="nav-btn" onclick="showHelp()">Help</button>
                <button class="nav-btn" onclick="showSettings()">Settings</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Welcome Section with Agent Greeting -->
        <div class="welcome-section">
            <div class="welcome-content">
                <h1 class="welcome-title">👥 Student Management Center</h1>
                <p class="welcome-subtitle">Comprehensive student information and academic management system</p>
                
                <!-- Student Management Agent Welcome Template -->
                <div class="agent-greeting">
                    <div class="agent-avatar">🤖</div>
                    <div class="agent-name">Sofia - Student Management Agent</div>
                    <div class="agent-role">AI-Powered Student Services Assistant</div>
                    <div class="agent-message">
                        Welcome to the Student Management Center! I'm Sofia, your intelligent assistant for all student-related tasks. 
                        I can help you manage enrollments, track academic progress, handle admissions, and provide insights on student performance. 
                        Let's work together to ensure every student's success! 🎓
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Left Sidebar -->
            <div class="sidebar-left">
                <!-- Sofia's Inbox -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">📧</div>
                        <div class="card-title">Sofia's Inbox</div>
                        <div class="notification-badge" id="inboxBadge">3</div>
                    </div>
                    <div class="inbox-list" id="inboxList">
                        <!-- Inbox items will be loaded here -->
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="markAllRead()">Mark All Read</button>
                    </div>
                </div>

                <!-- Student Statistics -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">📊</div>
                        <div class="card-title">Student Statistics</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item" onclick="showStatisticsDetail('total')" style="cursor: pointer;" title="Click for details">
                            <div class="stat-number" id="totalStudents">0</div>
                            <div class="stat-label">Total Students</div>
                        </div>
                        <div class="stat-item" onclick="showStatisticsDetail('semester')" style="cursor: pointer;" title="Click for details">
                            <div class="stat-number" id="newThisSemester">0</div>
                            <div class="stat-label">New This Semester</div>
                        </div>
                        <div class="stat-item" onclick="showStatisticsDetail('pending')" style="cursor: pointer;" title="Click for details">
                            <div class="stat-number" id="pendingCount">0</div>
                            <div class="stat-label">Pending Activation</div>
                        </div>
                        <div class="stat-item" onclick="showStatisticsDetail('gpa')" style="cursor: pointer;" title="Click for details">
                            <div class="stat-number" id="averageGPA">0.0</div>
                            <div class="stat-label">Average GPA</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">⚡</div>
                        <div class="card-title">Quick Actions</div>
                    </div>
                    <div class="quick-actions">
                        <div class="quick-action" onclick="addStudent()">
                            <div class="quick-action-icon">➕</div>
                            <div class="quick-action-text">Add Student</div>
                        </div>
                        <div class="quick-action" onclick="bulkImport()">
                            <div class="quick-action-icon">📁</div>
                            <div class="quick-action-text">Bulk Import</div>
                        </div>
                        <div class="quick-action" onclick="generateReports()">
                            <div class="quick-action-icon">📈</div>
                            <div class="quick-action-text">Reports</div>
                        </div>
                        <div class="quick-action" onclick="exportData()">
                            <div class="quick-action-icon">💾</div>
                            <div class="quick-action-text">Export Data</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Pending Student Activations -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">⏳</div>
                        <div class="card-title">Pending Student Activations</div>
                        <div class="workflow-badge">Enrollment Workflow</div>
                    </div>
                    
                    <div class="pending-list" id="pendingList">
                        <!-- Pending activations will be loaded here -->
                    </div>
                </div>

                <!-- Student Search and List -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">👥</div>
                        <div class="card-title">Active Student Directory</div>
                    </div>
                    
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Search students by name, ID, or email..." id="studentSearch">
                    </div>
                    
                    <div class="student-list" id="studentList">
                        <!-- Students will be loaded here -->
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="viewAllStudents()">View All Students</button>
                        <button class="btn btn-success" onclick="addNewStudent()">Add New Student</button>
                        <button class="btn btn-secondary" onclick="advancedSearch()">Advanced Search</button>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="sidebar-right">
                <!-- Recent Activities -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">🕐</div>
                        <div class="card-title">Recent Activities</div>
                    </div>
                    <div class="recent-activities" id="recentActivities">
                        <!-- Activities will be loaded here -->
                    </div>
                </div>

                <!-- Agent Assistant Panel -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">🤖</div>
                        <div class="card-title">Sofia's Insights</div>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3em; margin-bottom: 15px;">🎯</div>
                        <p style="color: #6c757d; line-height: 1.6;">
                            <strong>Today's Priority:</strong><br>
                            Review 12 pending applications and process 5 scholarship requests. 
                            3 students need academic advisement.
                        </p>
                        <button class="btn btn-primary" style="margin-top: 15px;" onclick="chatWithSofia()">
                            Chat with Sofia
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Activation Modal -->
    <div id="activationModal" class="activation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Student Activation Workflow</h2>
                <button class="close-btn" onclick="closeActivationModal()">&times;</button>
            </div>
            
            <div id="modalBody">
                <!-- Modal content will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <!-- Students Table Modal -->
    <div id="studentsTableModal" class="students-table-modal">
        <div class="table-modal-content">
            <div class="table-modal-header">
                <h2 class="table-modal-title">👥 All Students Database</h2>
                <button class="close-btn" onclick="closeStudentsTable()">&times;</button>
            </div>
            
            <div class="table-controls">
                <div class="table-search">
                    <input type="text" id="tableSearchInput" placeholder="Search students by name, ID, email, or major...">
                    <select id="statusFilter" onchange="filterStudents()">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="pending">Pending</option>
                        <option value="suspended">Suspended</option>
                    </select>
                    <select id="majorFilter" onchange="filterStudents()">
                        <option value="">All Majors</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Biology">Biology</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Business">Business</option>
                        <option value="Liberal Arts">Liberal Arts</option>
                    </select>
                </div>
                <div class="table-actions">
                    <button class="btn btn-success" onclick="openStudentForm('add')">
                        ➕ Add Student
                    </button>
                    <button class="btn btn-secondary" onclick="exportStudents()">
                        💾 Export
                    </button>
                    <button class="btn btn-primary" onclick="bulkImportStudents()">
                        📁 Import
                    </button>
                </div>
            </div>

            <div class="bulk-actions" id="bulkActions">
                <div class="bulk-actions-text">
                    <span id="selectedCount">0</span> students selected
                </div>
                <button class="btn btn-secondary" onclick="clearSelection()">Clear Selection</button>
                <button class="btn btn-primary" onclick="bulkEdit()">Bulk Edit</button>
                <button class="btn btn-reject" onclick="bulkDelete()">Delete Selected</button>
            </div>
            
            <div class="students-table-container">
                <table class="students-table" id="studentsTable">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                            </th>
                            <th>Avatar</th>
                            <th onclick="sortTable('id')" style="cursor: pointer;">Student ID ↕</th>
                            <th onclick="sortTable('name')" style="cursor: pointer;">Name ↕</th>
                            <th onclick="sortTable('email')" style="cursor: pointer;">Email ↕</th>
                            <th onclick="sortTable('major')" style="cursor: pointer;">Major ↕</th>
                            <th onclick="sortTable('year')" style="cursor: pointer;">Year ↕</th>
                            <th onclick="sortTable('gpa')" style="cursor: pointer;">GPA ↕</th>
                            <th onclick="sortTable('status')" style="cursor: pointer;">Status ↕</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Student rows will be populated here -->
                    </tbody>
                </table>
            </div>
            
            <div class="pagination">
                <div class="pagination-info" id="paginationInfo">
                    Showing 1-10 of 25 students
                </div>
                <div class="pagination-controls" id="paginationControls">
                    <!-- Pagination buttons will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Search Modal -->
    <div id="advancedSearchModal" class="students-table-modal">
        <div class="table-modal-content" style="max-width: 800px;">
            <div class="table-modal-header">
                <h2 class="table-modal-title">🔍 Advanced Student Search</h2>
                <button class="close-btn" onclick="closeAdvancedSearch()">&times;</button>
            </div>
            
            <div style="padding: 30px;">
                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
                    <div class="form-group-modal">
                        <label class="form-label-modal">Student ID</label>
                        <input type="text" id="searchStudentId" class="form-input-modal" placeholder="WU001 or 001">
                    </div>
                    <div class="form-group-modal">
                        <label class="form-label-modal">First Name</label>
                        <input type="text" id="searchFirstName" class="form-input-modal" placeholder="John">
                    </div>
                    <div class="form-group-modal">
                        <label class="form-label-modal">Last Name</label>
                        <input type="text" id="searchLastName" class="form-input-modal" placeholder="Doe">
                    </div>
                </div>

                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
                    <div class="form-group-modal">
                        <label class="form-label-modal">Email Domain</label>
                        <select id="searchEmailDomain" class="form-select-modal">
                            <option value="">All Domains</option>
                            <option value="@student.waldorf.edu">@student.waldorf.edu</option>
                            <option value="@waldorf.edu">@waldorf.edu</option>
                        </select>
                    </div>
                    <div class="form-group-modal">
                        <label class="form-label-modal">Major</label>
                        <select id="searchMajor" class="form-select-modal">
                            <option value="">All Majors</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Physics">Physics</option>
                            <option value="Chemistry">Chemistry</option>
                            <option value="Biology">Biology</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Business">Business</option>
                            <option value="Liberal Arts">Liberal Arts</option>
                        </select>
                    </div>
                    <div class="form-group-modal">
                        <label class="form-label-modal">Academic Year</label>
                        <select id="searchYear" class="form-select-modal">
                            <option value="">All Years</option>
                            <option value="1">Year 1 (Freshman)</option>
                            <option value="2">Year 2 (Sophomore)</option>
                            <option value="3">Year 3 (Junior)</option>
                            <option value="4">Year 4 (Senior)</option>
                            <option value="5">Year 5+ (Graduate)</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px;">
                    <div class="form-group-modal">
                        <label class="form-label-modal">Status</label>
                        <select id="searchStatus" class="form-select-modal">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="pending">Pending</option>
                            <option value="suspended">Suspended</option>
                        </select>
                    </div>
                    <div class="form-group-modal">
                        <label class="form-label-modal">GPA Range</label>
                        <select id="searchGPARange" class="form-select-modal">
                            <option value="">All GPAs</option>
                            <option value="4.0">4.0 (Perfect)</option>
                            <option value="3.7-4.0">3.7 - 4.0 (Excellent)</option>
                            <option value="3.0-3.6">3.0 - 3.6 (Good)</option>
                            <option value="2.5-2.9">2.5 - 2.9 (Average)</option>
                            <option value="0.0-2.4">0.0 - 2.4 (Below Average)</option>
                        </select>
                    </div>
                    <div class="form-group-modal">
                        <label class="form-label-modal">Enrollment Date</label>
                        <select id="searchEnrollmentPeriod" class="form-select-modal">
                            <option value="">All Dates</option>
                            <option value="2024">2024 (This Year)</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="older">Before 2021</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid full-width" style="margin-bottom: 25px;">
                    <div class="form-group-modal">
                        <label class="form-label-modal">Free Text Search</label>
                        <input type="text" id="searchFreeText" class="form-input-modal" 
                               placeholder="Search in address, emergency contact, phone, etc...">
                    </div>
                </div>

                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">📊 Search Results Preview</h4>
                    <div id="searchResultsPreview" style="color: #666;">
                        Enter search criteria above to see matching students...
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; gap: 15px;">
                    <div>
                        <button class="btn btn-secondary" onclick="clearAdvancedSearch()">
                            🗑️ Clear All
                        </button>
                        <button class="btn btn-primary" onclick="saveSearchPreset()">
                            💾 Save Search
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="closeAdvancedSearch()">
                            Cancel
                        </button>
                        <button class="btn btn-success" onclick="executeAdvancedSearch()">
                            🔍 Search Students
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reports Modal -->
    <div id="reportsModal" class="students-table-modal">
        <div class="table-modal-content" style="max-width: 900px;">
            <div class="table-modal-header">
                <h2 class="table-modal-title">📈 Student Reports & Analytics</h2>
                <button class="close-btn" onclick="closeReportsModal()">&times;</button>
            </div>
            
            <div style="padding: 30px;">
                <div class="quick-actions" style="grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div class="quick-action" onclick="generateEnrollmentReport()">
                        <div class="quick-action-icon">📊</div>
                        <div>Enrollment Statistics</div>
                    </div>
                    <div class="quick-action" onclick="generateGPAReport()">
                        <div class="quick-action-icon">🎓</div>
                        <div>GPA Analysis</div>
                    </div>
                    <div class="quick-action" onclick="generateDemographicsReport()">
                        <div class="quick-action-icon">👥</div>
                        <div>Demographics</div>
                    </div>
                    <div class="quick-action" onclick="generateMajorDistribution()">
                        <div class="quick-action-icon">📚</div>
                        <div>Major Distribution</div>
                    </div>
                    <div class="quick-action" onclick="generateActivityReport()">
                        <div class="quick-action-icon">📅</div>
                        <div>Recent Activity</div>
                    </div>
                    <div class="quick-action" onclick="generateCustomReport()">
                        <div class="quick-action-icon">⚙️</div>
                        <div>Custom Report</div>
                    </div>
                </div>

                <div id="reportContent" style="background: #f8f9fa; border-radius: 10px; padding: 25px; min-height: 300px;">
                    <div style="text-align: center; color: #666; padding: 50px;">
                        Select a report type above to generate analytics...
                    </div>
                </div>

                <div style="margin-top: 25px; display: flex; justify-content: space-between;">
                    <button class="btn btn-secondary" onclick="closeReportsModal()">Close</button>
                    <div>
                        <button class="btn btn-primary" onclick="printReport()">🖨️ Print Report</button>
                        <button class="btn btn-success" onclick="exportReportPDF()">📄 Export PDF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Import Modal -->
    <div id="bulkImportModal" class="students-table-modal">
        <div class="table-modal-content" style="max-width: 700px;">
            <div class="table-modal-header">
                <h2 class="table-modal-title">📁 Bulk Import Students</h2>
                <button class="close-btn" onclick="closeBulkImportModal()">&times;</button>
            </div>
            
            <div style="padding: 30px;">
                <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                    <h5 style="color: #0c5460; margin-bottom: 15px;">📋 Supported Import Formats</h5>
                    <ul style="color: #0c5460; margin: 0; padding-left: 20px;">
                        <li>CSV files (.csv)</li>
                        <li>Excel files (.xlsx, .xls)</li>
                        <li>JSON format (.json)</li>
                        <li>Tab-delimited text files (.txt)</li>
                    </ul>
                </div>

                <div class="form-grid full-width" style="margin-bottom: 25px;">
                    <div class="form-group-modal">
                        <label class="form-label-modal">Select Import File</label>
                        <input type="file" id="bulkImportFile" class="form-input-modal" 
                               accept=".csv,.xlsx,.xls,.json,.txt" onchange="previewImportFile()">
                    </div>
                </div>

                <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
                    <h5 style="color: #2c5530; margin-bottom: 15px;">📄 Required Columns</h5>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 0.9em; color: #666;">
                        <div>• Student ID</div>
                        <div>• First Name</div>
                        <div>• Last Name</div>
                        <div>• Email</div>
                        <div>• Major</div>
                        <div>• Academic Year</div>
                        <div>• Phone (Optional)</div>
                        <div>• Address (Optional)</div>
                        <div>• Emergency Contact (Optional)</div>
                    </div>
                </div>

                <div id="importPreview" style="background: #fff; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 25px; max-height: 300px; overflow: auto; display: none;">
                    <h5 style="color: #2c5530; margin-bottom: 15px;">👁️ Import Preview</h5>
                    <div id="importPreviewContent"></div>
                </div>

                <div style="display: flex; justify-content: space-between; gap: 15px;">
                    <div>
                        <button class="btn btn-secondary" onclick="downloadTemplate()">
                            📥 Download Template
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="closeBulkImportModal()">Cancel</button>
                        <button class="btn btn-success" onclick="processImport()" id="processImportBtn" disabled>
                            ⬆️ Import Students
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Detail Modal -->
    <div id="statisticsModal" class="students-table-modal">
        <div class="table-modal-content" style="max-width: 1000px;">
            <div class="table-modal-header">
                <h2 class="table-modal-title" id="statisticsModalTitle">📊 Student Statistics</h2>
                <button class="close-btn" onclick="closeStatisticsModal()">&times;</button>
            </div>
            
            <div style="padding: 30px;">
                <div id="statisticsContent">
                    <!-- Statistics content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Student Form Modal -->
    <div id="studentFormModal" class="student-form-modal">
        <div class="form-modal-content">
            <div class="form-modal-header">
                <h2 id="formModalTitle">Add New Student</h2>
                <button class="close-btn" onclick="closeStudentForm()">&times;</button>
            </div>
            
            <div class="form-modal-body">
                <div id="formValidationSummary" style="display: none; background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h5 style="color: #856404; margin: 0 0 10px 0;">📝 Form Completion Status</h5>
                    <ul id="validationList" style="margin: 0; padding-left: 20px; color: #856404;">
                    </ul>
                </div>
                
                <form id="studentForm">
                    <div class="form-grid">
                        <div class="form-group-modal">
                            <label for="studentId" class="form-label-modal">Student ID</label>
                            <input type="text" id="studentId" name="studentId" class="form-input-modal" placeholder="WU001" required>
                        </div>
                        <div class="form-group-modal">
                            <label for="studentStatus" class="form-label-modal">Status</label>
                            <select id="studentStatus" name="status" class="form-select-modal" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="pending">Pending</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group-modal">
                            <label for="firstName" class="form-label-modal">First Name</label>
                            <input type="text" id="firstName" name="firstName" class="form-input-modal" placeholder="John" required 
                                   onblur="generateEmailAddress()">
                        </div>
                        <div class="form-group-modal">
                            <label for="lastName" class="form-label-modal">Last Name</label>
                            <input type="text" id="lastName" name="lastName" class="form-input-modal" placeholder="Doe" required 
                                   onblur="generateEmailAddress()">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group-modal">
                            <label for="studentEmail" class="form-label-modal">
                                Email Address 
                                <small style="color: #6c757d;">(Auto-generated from name)</small>
                            </label>
                            <input type="email" id="studentEmail" name="email" class="form-input-modal" placeholder="john.doe@student.waldorf.edu" required>
                        </div>
                        <div class="form-group-modal">
                            <label for="studentPhone" class="form-label-modal">Phone Number</label>
                            <input type="tel" id="studentPhone" name="phone" class="form-input-modal" placeholder="+1 (555) 123-4567"
                                   pattern="[+]?[0-9\s\(\)\-]+" title="Please enter a valid phone number"
                                   oninput="formatPhoneNumber(this)">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group-modal">
                            <label for="studentMajor" class="form-label-modal">Major</label>
                            <select id="studentMajor" name="major" class="form-select-modal" required>
                                <option value="">Select Major</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="Physics">Physics</option>
                                <option value="Chemistry">Chemistry</option>
                                <option value="Biology">Biology</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Business">Business</option>
                                <option value="Liberal Arts">Liberal Arts</option>
                            </select>
                        </div>
                        <div class="form-group-modal">
                            <label for="studentYear" class="form-label-modal">Academic Year</label>
                            <select id="studentYear" name="year" class="form-select-modal" required>
                                <option value="">Select Year</option>
                                <option value="1">Year 1 (Freshman)</option>
                                <option value="2">Year 2 (Sophomore)</option>
                                <option value="3">Year 3 (Junior)</option>
                                <option value="4">Year 4 (Senior)</option>
                                <option value="5">Year 5+ (Graduate)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group-modal">
                            <label for="studentGPA" class="form-label-modal">
                                GPA 
                                <small style="color: #6c757d;">(0.0 - 4.0 scale)</small>
                            </label>
                            <input type="number" id="studentGPA" name="gpa" class="form-input-modal" placeholder="3.75" 
                                   min="0" max="4" step="0.01" oninput="validateGPA()">
                        </div>
                        <div class="form-group-modal">
                            <label for="enrollmentDate" class="form-label-modal">Enrollment Date</label>
                            <input type="date" id="enrollmentDate" name="enrollmentDate" class="form-input-modal">
                        </div>
                    </div>

                    <div class="form-grid full-width">
                        <div class="form-group-modal">
                            <label for="studentAddress" class="form-label-modal">Address</label>
                            <input type="text" id="studentAddress" name="address" class="form-input-modal" placeholder="123 Main St, City, State, ZIP">
                        </div>
                    </div>

                    <div class="form-grid full-width">
                        <div class="form-group-modal">
                            <label for="emergencyContact" class="form-label-modal">Emergency Contact</label>
                            <input type="text" id="emergencyContact" name="emergencyContact" class="form-input-modal" placeholder="Contact Name - Phone Number">
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeStudentForm()">Cancel</button>
                <button type="button" class="btn btn-success" onclick="saveStudent()" id="saveStudentBtn">
                    Save Student
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sample student data
        const students = [
            {
                id: 'WU001',
                name: 'Alice Johnson',
                email: 'alice.johnson@waldorf.edu',
                major: 'Computer Science',
                year: 2,
                gpa: 3.8,
                status: 'active'
            },
            {
                id: 'WU002',
                name: 'Bob Smith',
                email: 'bob.smith@waldorf.edu',
                major: 'Mathematics',
                year: 3,
                gpa: 3.6,
                status: 'active'
            },
            {
                id: 'WU003',
                name: 'Carol Davis',
                email: 'carol.davis@waldorf.edu',
                major: 'Physics',
                year: 1,
                gpa: 3.9,
                status: 'active'
            }
        ];

        // Pending student activations from Student Affairs
        const pendingActivations = [
            {
                id: 'WU006',
                name: 'Michael Rodriguez',
                email: 'michael.rodriguez@student.waldorf.edu',
                major: 'Engineering',
                year: 1,
                enrollmentDate: '2024-12-08',
                phone: '+1 (555) 123-4567',
                address: '123 Main St, Springfield, IL',
                emergencyContact: 'Maria Rodriguez - (555) 987-6543',
                status: 'pending_activation'
            },
            {
                id: 'WU007',
                name: 'Sarah Chen',
                email: 'sarah.chen@student.waldorf.edu',
                major: 'Business',
                year: 1,
                enrollmentDate: '2024-12-08',
                phone: '+1 (555) 234-5678',
                address: '456 Oak Ave, Chicago, IL',
                emergencyContact: 'David Chen - (555) 876-5432',
                status: 'pending_activation'
            },
            {
                id: 'WU008',
                name: 'James Thompson',
                email: 'james.thompson@student.waldorf.edu',
                major: 'Computer Science',
                year: 1,
                enrollmentDate: '2024-12-07',
                phone: '+1 (555) 345-6789',
                address: '789 Pine Rd, Milwaukee, WI',
                emergencyContact: 'Linda Thompson - (555) 765-4321',
                status: 'pending_activation'
            },
            {
                id: 'WU009',
                name: 'Emily Davis',
                email: 'emily.davis@student.waldorf.edu',
                major: 'Liberal Arts',
                year: 1,
                enrollmentDate: '2024-12-07',
                phone: '+1 (555) 456-7890',
                address: '321 Cedar St, Madison, WI',
                emergencyContact: 'Robert Davis - (555) 654-3210',
                status: 'pending_activation'
            },
            {
                id: 'WU010',
                name: 'Alex Kumar',
                email: 'alex.kumar@student.waldorf.edu',
                major: 'Mathematics',
                year: 1,
                enrollmentDate: '2024-12-06',
                phone: '+1 (555) 567-8901',
                address: '654 Elm Dr, Detroit, MI',
                emergencyContact: 'Priya Kumar - (555) 543-2109',
                status: 'pending_activation'
            }
        ];

        // Sofia's inbox messages from Student Affairs
        const inboxMessages = [
            {
                id: 1,
                sender: 'Student Affairs Office',
                senderEmail: 'affairs@waldorf.edu',
                subject: 'New Student Enrollment - Michael Rodriguez',
                preview: 'New student Michael Rodriguez has completed enrollment process and requires system activation...',
                time: '5 minutes ago',
                read: false,
                studentId: 'WU006',
                fullMessage: `Dear Sofia,

We have a new student enrollment that requires your attention:

Student: Michael Rodriguez
Student ID: WU006
Major: Engineering
Email: michael.rodriguez@student.waldorf.edu
Enrollment Date: December 8, 2024

The student has completed all enrollment requirements and documentation. Please activate their account in the system and generate login credentials.

Once activated, please send the login information back to our office so we can forward it to the student's email address.

Thank you,
Student Affairs Office
Waldorf Colleges & Universities`
            },
            {
                id: 2,
                sender: 'Student Affairs Office',
                senderEmail: 'affairs@waldorf.edu',
                subject: 'Urgent: Bulk Enrollment - 3 Students Pending',
                preview: 'We have 3 additional students (Sarah Chen, James Thompson, Emily Davis) who completed enrollment yesterday...',
                time: '2 hours ago',
                read: false,
                studentIds: ['WU007', 'WU008', 'WU009'],
                fullMessage: `Dear Sofia,

We have processed a bulk enrollment for 3 new students who completed their registration yesterday:

1. Sarah Chen (WU007) - Business Major
2. James Thompson (WU008) - Computer Science Major  
3. Emily Davis (WU009) - Liberal Arts Major

All students have submitted required documentation and paid enrollment fees. Please activate their accounts and generate login credentials for each.

Please send the credentials back to us by end of day so we can distribute them to the students.

Best regards,
Student Affairs Office`
            },
            {
                id: 3,
                sender: 'Student Affairs Office',
                senderEmail: 'affairs@waldorf.edu',
                subject: 'Follow-up: Alex Kumar Enrollment',
                preview: 'Following up on Alex Kumar (WU010) enrollment from December 6th. Student is requesting access...',
                time: '1 day ago',
                read: true,
                studentId: 'WU010',
                fullMessage: `Dear Sofia,

This is a follow-up regarding Alex Kumar (WU010) who enrolled on December 6th. The student has been calling our office requesting access to the student portal.

Please prioritize the activation of this account as the student needs to register for classes before the deadline.

Student Details:
- Alex Kumar
- Student ID: WU010
- Major: Mathematics
- Email: alex.kumar@student.waldorf.edu

Thank you for your prompt attention to this matter.

Student Affairs Office`
            }
        ];

        const activities = [
            { icon: '📧', text: 'New enrollment notification from Student Affairs', time: '5 minutes ago' },
            { icon: '✅', text: 'Activated student account for Alice Johnson', time: '15 minutes ago' },
            { icon: '📨', text: 'Sent login credentials to Student Affairs', time: '1 hour ago' },
            { icon: '🎓', text: 'Processed bulk enrollment (3 students)', time: '2 hours ago' },
            { icon: '📊', text: 'Generated enrollment workflow report', time: '3 hours ago' },
            { icon: '🔐', text: 'Generated secure passwords for 5 new students', time: '4 hours ago' }
        ];

        // Initialize the page
        function initializePage() {
            loadStudents();
            loadActivities();
            loadInbox();
            loadPendingActivations();
            setupSearch();
            updateCounts();
        }

        function loadStudents() {
            const studentList = document.getElementById('studentList');
            studentList.innerHTML = '';
            
            students.forEach(student => {
                const statusClass = `status-${student.status}`;
                const initials = student.name.split(' ').map(n => n[0]).join('');
                
                studentList.innerHTML += `
                    <div class="student-item">
                        <div class="student-avatar">${initials}</div>
                        <div class="student-info">
                            <div class="student-name">${student.name}</div>
                            <div class="student-details">${student.id} • ${student.major} • Year ${student.year} • GPA: ${student.gpa}</div>
                        </div>
                        <div class="student-status ${statusClass}">${student.status.toUpperCase()}</div>
                    </div>
                `;
            });
        }

        function loadActivities() {
            const activitiesContainer = document.getElementById('recentActivities');
            activitiesContainer.innerHTML = '';
            
            activities.forEach(activity => {
                activitiesContainer.innerHTML += `
                    <div class="activity-item">
                        <div class="activity-icon">${activity.icon}</div>
                        <div class="activity-content">
                            <div class="activity-text">${activity.text}</div>
                            <div class="activity-time">${activity.time}</div>
                        </div>
                    </div>
                `;
            });
        }

        function loadInbox() {
            const inboxList = document.getElementById('inboxList');
            inboxList.innerHTML = '';
            
            inboxMessages.forEach(message => {
                const unreadClass = message.read ? '' : 'unread';
                
                inboxList.innerHTML += `
                    <div class="inbox-item ${unreadClass}" onclick="openMessage(${message.id})">
                        <div class="inbox-header">
                            <div class="inbox-sender">${message.sender}</div>
                            <div class="inbox-time">${message.time}</div>
                        </div>
                        <div class="inbox-subject">${message.subject}</div>
                        <div class="inbox-preview">${message.preview}</div>
                    </div>
                `;
            });
        }

        function loadPendingActivations() {
            const pendingList = document.getElementById('pendingList');
            pendingList.innerHTML = '';
            
            pendingActivations.forEach(student => {
                pendingList.innerHTML += `
                    <div class="pending-item">
                        <div class="pending-header">
                            <div class="pending-student">${student.name}</div>
                            <div class="pending-status">PENDING ACTIVATION</div>
                        </div>
                        <div class="pending-details">
                            <div class="pending-detail">
                                🆔 <span>${student.id}</span>
                            </div>
                            <div class="pending-detail">
                                📚 <span>${student.major}</span>
                            </div>
                            <div class="pending-detail">
                                📧 <span>${student.email}</span>
                            </div>
                            <div class="pending-detail">
                                📅 <span>Enrolled: ${student.enrollmentDate}</span>
                            </div>
                        </div>
                        <div class="pending-actions">
                            <button class="btn btn-activate" onclick="activateStudent('${student.id}')">
                                ✅ Activate Student
                            </button>
                            <button class="btn btn-details" onclick="viewStudentDetails('${student.id}')">
                                📋 View Details
                            </button>
                            <button class="btn btn-reject" onclick="rejectActivation('${student.id}')">
                                ❌ Reject
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        function updateCounts() {
            const unreadCount = inboxMessages.filter(msg => !msg.read).length;
            const pendingCount = pendingActivations.length;
            
            document.getElementById('inboxBadge').textContent = unreadCount;
            document.getElementById('pendingCount').textContent = pendingCount;
            
            // Update all statistics
            updateStudentStatistics();
        }

        function updateStudentStatistics() {
            const stats = calculateStudentStatistics();
            
            // Update dashboard statistics
            document.getElementById('totalStudents').textContent = stats.total;
            document.getElementById('newThisSemester').textContent = stats.newSemester;
            document.getElementById('pendingCount').textContent = stats.pending;
            document.getElementById('averageGPA').textContent = stats.avgGPA;
        }

        function calculateStudentStatistics() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const semesterStart = new Date(currentYear, 7, 1); // August 1st

            // Total students
            const total = allStudents.length;

            // New this semester
            const newSemester = allStudents.filter(student => {
                const enrollDate = new Date(student.enrollmentDate);
                return enrollDate >= semesterStart;
            }).length;

            // Pending activations
            const pending = pendingActivations.length;

            // Average GPA
            const totalGPA = allStudents.reduce((sum, student) => sum + student.gpa, 0);
            const avgGPA = total > 0 ? (totalGPA / total).toFixed(1) : '0.0';

            // Status breakdown
            const statusBreakdown = {
                active: allStudents.filter(s => s.status === 'active').length,
                inactive: allStudents.filter(s => s.status === 'inactive').length,
                pending: allStudents.filter(s => s.status === 'pending').length,
                suspended: allStudents.filter(s => s.status === 'suspended').length
            };

            // Major distribution
            const majorDistribution = {};
            allStudents.forEach(student => {
                majorDistribution[student.major] = (majorDistribution[student.major] || 0) + 1;
            });

            // Year distribution
            const yearDistribution = {};
            allStudents.forEach(student => {
                const year = 'Year ' + student.year;
                yearDistribution[year] = (yearDistribution[year] || 0) + 1;
            });

            // GPA distribution
            const gpaDistribution = {
                excellent: allStudents.filter(s => s.gpa >= 3.7).length,
                good: allStudents.filter(s => s.gpa >= 3.0 && s.gpa < 3.7).length,
                average: allStudents.filter(s => s.gpa >= 2.5 && s.gpa < 3.0).length,
                poor: allStudents.filter(s => s.gpa < 2.5).length
            };

            return {
                total,
                newSemester,
                pending,
                avgGPA,
                statusBreakdown,
                majorDistribution,
                yearDistribution,
                gpaDistribution
            };
        }

        function showStatisticsDetail(type) {
            const stats = calculateStudentStatistics();
            const modal = document.getElementById('statisticsModal');
            const title = document.getElementById('statisticsModalTitle');
            const content = document.getElementById('statisticsContent');

            switch (type) {
                case 'total':
                    title.textContent = '👥 Total Students Breakdown';
                    content.innerHTML = generateTotalStudentsReport(stats);
                    break;
                case 'semester':
                    title.textContent = '📅 New Students This Semester';
                    content.innerHTML = generateNewSemesterReport(stats);
                    break;
                case 'pending':
                    title.textContent = '⏳ Pending Activations';
                    content.innerHTML = generatePendingReport(stats);
                    break;
                case 'gpa':
                    title.textContent = '🎓 GPA Analysis';
                    content.innerHTML = generateGPAReport(stats);
                    break;
            }

            modal.style.display = 'block';
        }

        function generateTotalStudentsReport(stats) {
            return '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px;">' +
                '<div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">' +
                '<h4 style="color: #2c5530; margin-bottom: 15px;">📈 Status Distribution</h4>' +
                '<div style="display: grid; gap: 10px;">' +
                '<div style="display: flex; justify-content: space-between;">' +
                '<span>Active:</span><strong style="color: #28a745;">' + stats.statusBreakdown.active + '</strong>' +
                '</div>' +
                '<div style="display: flex; justify-content: space-between;">' +
                '<span>Inactive:</span><strong style="color: #dc3545;">' + stats.statusBreakdown.inactive + '</strong>' +
                '</div>' +
                '<div style="display: flex; justify-content: space-between;">' +
                '<span>Pending:</span><strong style="color: #ffc107;">' + stats.statusBreakdown.pending + '</strong>' +
                '</div>' +
                '<div style="display: flex; justify-content: space-between;">' +
                '<span>Suspended:</span><strong style="color: #fd7e14;">' + stats.statusBreakdown.suspended + '</strong>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">' +
                '<h4 style="color: #2c5530; margin-bottom: 15px;">📚 Major Distribution</h4>' +
                '<div style="display: grid; gap: 8px; font-size: 0.9em;">' +
                Object.entries(stats.majorDistribution).map(([major, count]) =>
                    '<div style="display: flex; justify-content: space-between;">' +
                    '<span>' + major + ':</span><strong>' + count + '</strong>' +
                    '</div>'
                ).join('') +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div style="margin-top: 25px; background: #e8f5e8; border-radius: 10px; padding: 20px;">' +
                '<h4 style="color: #155724; margin-bottom: 15px;">📊 Academic Year Distribution</h4>' +
                '<div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; text-align: center;">' +
                Object.entries(stats.yearDistribution).map(([year, count]) =>
                    '<div style="background: white; padding: 15px; border-radius: 8px;">' +
                    '<div style="font-size: 1.5em; font-weight: bold; color: #2c5530;">' + count + '</div>' +
                    '<div style="font-size: 0.9em; color: #666;">' + year + '</div>' +
                    '</div>'
                ).join('') +
                '</div>' +
                '</div>';
        }

        function generateNewSemesterReport(stats) {
            const currentDate = new Date();
            const semesterStart = new Date(currentDate.getFullYear(), 7, 1);
            const newStudents = allStudents.filter(student => {
                const enrollDate = new Date(student.enrollmentDate);
                return enrollDate >= semesterStart;
            });

            return '<div style="background: #fff3cd; border-radius: 10px; padding: 20px; margin-bottom: 20px;">' +
                '<h4 style="color: #856404; margin-bottom: 15px;">📅 Semester Overview</h4>' +
                '<p style="color: #856404;">Students enrolled since ' + semesterStart.toLocaleDateString() + '</p>' +
                '<div style="font-size: 2em; font-weight: bold; color: #856404; text-align: center; margin: 15px 0;">' +
                stats.newSemester + ' New Students</div>' +
                '</div>' +
                '<div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">' +
                '<h4 style="color: #2c5530; margin-bottom: 15px;">👥 New Students List</h4>' +
                (newStudents.length > 0 ?
                    '<div style="max-height: 300px; overflow-y: auto;">' +
                    newStudents.map(student =>
                        '<div style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #28a745;">' +
                        '<div style="font-weight: 600;">' + student.firstName + ' ' + student.lastName + ' (' + student.id + ')</div>' +
                        '<div style="color: #666; font-size: 0.9em;">' + student.major + ' • Year ' + student.year + ' • Enrolled: ' + student.enrollmentDate + '</div>' +
                        '</div>'
                    ).join('') +
                    '</div>' :
                    '<p style="text-align: center; color: #666; padding: 20px;">No new students this semester</p>'
                ) +
                '</div>';
        }

        function generatePendingReport(stats) {
            return '<div style="background: #fff3cd; border-radius: 10px; padding: 20px; margin-bottom: 20px;">' +
                '<h4 style="color: #856404; margin-bottom: 15px;">⏳ Pending Activations</h4>' +
                '<div style="font-size: 2em; font-weight: bold; color: #856404; text-align: center; margin: 15px 0;">' +
                stats.pending + ' Students Awaiting Activation</div>' +
                '</div>' +
                '<div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">' +
                '<h4 style="color: #2c5530; margin-bottom: 15px;">📋 Pending Students</h4>' +
                (pendingActivations.length > 0 ?
                    '<div style="max-height: 300px; overflow-y: auto;">' +
                    pendingActivations.map(student =>
                        '<div style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #ffc107;">' +
                        '<div style="font-weight: 600;">' + student.name + ' (' + student.id + ')</div>' +
                        '<div style="color: #666; font-size: 0.9em;">' + student.major + ' • ' + student.email + '</div>' +
                        '<div style="margin-top: 10px;">' +
                        '<button class="btn btn-success" style="font-size: 0.8em; padding: 5px 10px;" onclick="activateStudent(\'' + student.id + '\'); closeStatisticsModal();">Activate Now</button>' +
                        '</div>' +
                        '</div>'
                    ).join('') +
                    '</div>' :
                    '<p style="text-align: center; color: #666; padding: 20px;">No students pending activation</p>'
                ) +
                '</div>';
        }

        function generateGPAReport(stats) {
            return '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px;">' +
                '<div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">' +
                '<h4 style="color: #2c5530; margin-bottom: 15px;">📊 GPA Distribution</h4>' +
                '<div style="display: grid; gap: 12px;">' +
                '<div style="background: #d4edda; padding: 10px; border-radius: 6px; display: flex; justify-content: space-between;">' +
                '<span>🏆 Excellent (3.7-4.0):</span><strong>' + stats.gpaDistribution.excellent + '</strong>' +
                '</div>' +
                '<div style="background: #cce5ff; padding: 10px; border-radius: 6px; display: flex; justify-content: space-between;">' +
                '<span>👍 Good (3.0-3.6):</span><strong>' + stats.gpaDistribution.good + '</strong>' +
                '</div>' +
                '<div style="background: #fff3cd; padding: 10px; border-radius: 6px; display: flex; justify-content: space-between;">' +
                '<span>📈 Average (2.5-2.9):</span><strong>' + stats.gpaDistribution.average + '</strong>' +
                '</div>' +
                '<div style="background: #f8d7da; padding: 10px; border-radius: 6px; display: flex; justify-content: space-between;">' +
                '<span>📉 Below Average (&lt;2.5):</span><strong>' + stats.gpaDistribution.poor + '</strong>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div style="background: #e8f5e8; border-radius: 10px; padding: 20px;">' +
                '<h4 style="color: #155724; margin-bottom: 15px;">🎯 Academic Insights</h4>' +
                '<div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">' +
                '<div style="font-size: 1.5em; font-weight: bold; color: #2c5530; text-align: center;">' + stats.avgGPA + '</div>' +
                '<div style="text-align: center; color: #666;">Overall Average GPA</div>' +
                '</div>' +
                '<div style="font-size: 0.9em; color: #155724;">' +
                '<p><strong>Top Performers:</strong> ' + stats.gpaDistribution.excellent + ' students with 3.7+ GPA</p>' +
                '<p><strong>Academic Support:</strong> ' + stats.gpaDistribution.poor + ' students may need assistance</p>' +
                '<p><strong>Success Rate:</strong> ' + Math.round(((stats.gpaDistribution.excellent + stats.gpaDistribution.good) / stats.total) * 100) + '% above 3.0 GPA</p>' +
                '</div>' +
                '</div>' +
                '</div>';
        }

        function closeStatisticsModal() {
            document.getElementById('statisticsModal').style.display = 'none';
        }

        function closeBulkImportModal() {
            document.getElementById('bulkImportModal').style.display = 'none';
            // Reset form
            document.getElementById('bulkImportFile').value = '';
            document.getElementById('importPreview').style.display = 'none';
            document.getElementById('processImportBtn').disabled = true;
        }

        function closeReportsModal() {
            document.getElementById('reportsModal').style.display = 'none';
        }

        function previewImportFile() {
            const fileInput = document.getElementById('bulkImportFile');
            const file = fileInput.files[0];
            const previewDiv = document.getElementById('importPreview');
            const previewContent = document.getElementById('importPreviewContent');
            const processBtn = document.getElementById('processImportBtn');

            if (!file) {
                previewDiv.style.display = 'none';
                processBtn.disabled = true;
                return;
            }

            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let data = [];
                    
                    if (file.type === 'application/json' || file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                    } else if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
                        data = parseCSV(e.target.result);
                    } else {
                        throw new Error('Unsupported file format');
                    }

                    // Validate required columns
                    const requiredColumns = ['Student ID', 'First Name', 'Last Name', 'Email', 'Major', 'Academic Year'];
                    const fileColumns = data.length > 0 ? Object.keys(data[0]) : [];
                    const missingColumns = requiredColumns.filter(col => !fileColumns.includes(col));

                    let previewHTML = '';
                    
                    if (missingColumns.length > 0) {
                        previewHTML = `<div style="color: #dc3545; background: #f8d7da; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                            <strong>⚠️ Missing Required Columns:</strong><br>
                            ${missingColumns.join(', ')}<br>
                            <small>Please ensure your file contains all required columns.</small>
                        </div>`;
                        processBtn.disabled = true;
                    } else {
                        previewHTML = `<div style="color: #155724; background: #d4edda; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                            <strong>✅ File Format Valid</strong><br>
                            Found ${data.length} student records ready for import.
                        </div>`;
                        processBtn.disabled = false;
                    }

                    // Show preview of first 5 records
                    if (data.length > 0) {
                        previewHTML += '<h6>Preview (First 5 Records):</h6>';
                        previewHTML += '<div style="overflow-x: auto; max-height: 200px; border: 1px solid #dee2e6; border-radius: 4px;">';
                        previewHTML += '<table style="width: 100%; border-collapse: collapse; font-size: 0.8em;">';
                        
                        // Header
                        previewHTML += '<thead><tr style="background: #f8f9fa;">';
                        fileColumns.forEach(col => {
                            previewHTML += `<th style="padding: 8px; border: 1px solid #dee2e6; text-align: left;">${col}</th>`;
                        });
                        previewHTML += '</tr></thead>';
                        
                        // Data rows (first 5)
                        previewHTML += '<tbody>';
                        data.slice(0, 5).forEach(row => {
                            previewHTML += '<tr>';
                            fileColumns.forEach(col => {
                                previewHTML += `<td style="padding: 8px; border: 1px solid #dee2e6;">${row[col] || ''}</td>`;
                            });
                            previewHTML += '</tr>';
                        });
                        previewHTML += '</tbody></table></div>';
                    }

                    previewContent.innerHTML = previewHTML;
                    previewDiv.style.display = 'block';

                } catch (error) {
                    previewContent.innerHTML = `<div style="color: #dc3545; background: #f8d7da; padding: 15px; border-radius: 6px;">
                        <strong>❌ Error Reading File:</strong><br>
                        ${error.message}<br>
                        <small>Please check your file format and try again.</small>
                    </div>`;
                    previewDiv.style.display = 'block';
                    processBtn.disabled = true;
                }
            };

            reader.readAsText(file);
        }

        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            if (lines.length < 2) throw new Error('CSV file must have at least a header row and one data row.');
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                data.push(row);
            }
            
            return data;
        }

        function downloadTemplate() {
            const templateData = [
                ['Student ID', 'First Name', 'Last Name', 'Email', 'Phone', 'Major', 'Academic Year', 'Address', 'Emergency Contact'],
                ['WU001', 'John', 'Doe', 'john.doe@student.waldorf.edu', '+1 (555) 123-4567', 'Computer Science', '1', '123 Main St, City, State 12345', 'Jane Doe - (555) 987-6543'],
                ['WU002', 'Jane', 'Smith', 'jane.smith@student.waldorf.edu', '+1 (555) 234-5678', 'Mathematics', '2', '456 Oak Ave, City, State 12345', 'John Smith - (555) 876-5432']
            ];
            
            const csvContent = templateData.map(row => row.join(',')).join('\n');
            downloadFile(csvContent, 'waldorf_student_template.csv', 'text/csv');
            showNotification('📥 Template downloaded successfully! Fill it out and import your student data.', 'success');
        }

        function processImport() {
            const fileInput = document.getElementById('bulkImportFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import.');
                return;
            }

            const processBtn = document.getElementById('processImportBtn');
            processBtn.textContent = '⏳ Processing...';
            processBtn.disabled = true;

            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    let data = [];
                    
                    if (file.type === 'application/json' || file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                    } else if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
                        data = parseCSV(e.target.result);
                    }

                    let successCount = 0;
                    let errorCount = 0;
                    const errors = [];

                    data.forEach((row, index) => {
                        try {
                            // Map CSV columns to student object
                            const studentData = {
                                id: row['Student ID'] || generateStudentId(),
                                firstName: row['First Name'],
                                lastName: row['Last Name'],
                                email: row['Email'],
                                phone: row['Phone'] || '',
                                major: row['Major'],
                                year: parseInt(row['Academic Year']) || 1,
                                gpa: parseFloat(row['GPA']) || 0.0,
                                status: row['Status'] || 'active',
                                enrollmentDate: row['Enrollment Date'] || new Date().toISOString().split('T')[0],
                                address: row['Address'] || '',
                                emergencyContact: row['Emergency Contact'] || ''
                            };

                            // Validate required fields
                            if (!studentData.firstName || !studentData.lastName || !studentData.email || !studentData.major) {
                                throw new Error(`Row ${index + 2}: Missing required fields`);
                            }

                            // Check for duplicate ID
                            if (allStudents.find(s => s.id === studentData.id)) {
                                throw new Error(`Row ${index + 2}: Student ID ${studentData.id} already exists`);
                            }

                            // Add to students array
                            allStudents.push(studentData);
                            
                            // Add to main students list for dashboard
                            students.push({
                                id: studentData.id,
                                name: `${studentData.firstName} ${studentData.lastName}`,
                                email: studentData.email,
                                major: studentData.major,
                                year: studentData.year,
                                gpa: studentData.gpa,
                                status: studentData.status
                            });

                            successCount++;

                        } catch (error) {
                            errors.push(error.message);
                            errorCount++;
                        }
                    });

                    // Show results
                    let resultMessage = `🎉 Bulk Import Completed!\n\n✅ Successfully imported: ${successCount} students`;
                    
                    if (errorCount > 0) {
                        resultMessage += `\n❌ Errors: ${errorCount} students\n\nError details:\n${errors.join('\n')}`;
                    }

                    alert(resultMessage);

                    // Update dashboard
                    if (typeof loadStudents === 'function') {
                        loadStudents();
                        loadActivities();
                        updateCounts();
                    }

                    // Add activity
                    activities.unshift({
                        icon: '📁',
                        text: `Bulk import completed: ${successCount} students added`,
                        time: 'Just now'
                    });

                    loadStudentsTable();
                    closeBulkImportModal();

                } catch (error) {
                    alert(`❌ Import Error: ${error.message}`);
                } finally {
                    processBtn.textContent = '⬆️ Import Students';
                    processBtn.disabled = false;
                }
            };

            reader.readAsText(file);
        }

        function generateStudentId() {
            const prefix = 'WU';
            const existingIds = allStudents.map(s => s.id);
            let number = 1;
            
            while (existingIds.includes(`${prefix}${number.toString().padStart(3, '0')}`)) {
                number++;
            }
            
            return `${prefix}${number.toString().padStart(3, '0')}`;
        }

        function printReport() {
            const reportData = generateDetailedReport();
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Waldorf Student Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .summary { background: #f9f9f9; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
                        @media print { 
                            body { margin: 10px; } 
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    ${reportData}
                    <div class="no-print" style="margin-top: 20px; text-align: center;">
                        <button onclick="window.print()" style="padding: 10px 20px; font-size: 16px;">🖨️ Print Report</button>
                        <button onclick="window.close()" style="padding: 10px 20px; font-size: 16px; margin-left: 10px;">❌ Close</button>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        function exportReportPDF() {
            // For PDF export, we'll open the print dialog with instructions
            const reportData = generateDetailedReport();
            const pdfWindow = window.open('', '_blank');
            pdfWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Waldorf Student Report - PDF Export</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .summary { background: #f9f9f9; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
                        .instructions { background: #e8f5e8; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
                    </style>
                </head>
                <body>
                    <div class="instructions">
                        <h3>📄 PDF Export Instructions</h3>
                        <p>To save as PDF:</p>
                        <ol>
                            <li>Press Ctrl+P (Windows) or Cmd+P (Mac)</li>
                            <li>Select "Save as PDF" as the printer destination</li>
                            <li>Choose your save location and click Save</li>
                        </ol>
                    </div>
                    ${reportData}
                    <script>
                        // Print dialog removed - user can manually print if needed
                        // setTimeout(() => window.print(), 1000);
                    </script>
                </body>
                </html>
            `);
            showNotification('📄 PDF export window opened. Use the print dialog to save as PDF.', 'success');
        }

        function generateDetailedReport() {
            const now = new Date();
            const stats = calculateStudentStatistics();
            
            return `
                <div class="header">
                    <h1>🎓 Waldorf Colleges & Universities</h1>
                    <h2>Comprehensive Student Report</h2>
                    <p>Generated on ${now.toLocaleDateString()} at ${now.toLocaleTimeString()}</p>
                </div>
                
                <div class="summary">
                    <h3>📊 Summary Statistics</h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                        <div><strong>Total Students:</strong> ${stats.total}</div>
                        <div><strong>Active Students:</strong> ${stats.statusBreakdown.active}</div>
                        <div><strong>Average GPA:</strong> ${stats.avgGPA}</div>
                        <div><strong>New This Semester:</strong> ${stats.newSemester}</div>
                    </div>
                </div>

                <div class="summary">
                    <h3>🎯 Academic Performance Distribution</h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div>Excellent (3.7-4.0): <strong>${stats.gpaDistribution.excellent}</strong></div>
                        <div>Good (3.0-3.6): <strong>${stats.gpaDistribution.good}</strong></div>
                        <div>Average (2.5-2.9): <strong>${stats.gpaDistribution.average}</strong></div>
                        <div>Below Average (&lt;2.5): <strong>${stats.gpaDistribution.poor}</strong></div>
                    </div>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Student ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Major</th>
                            <th>Year</th>
                            <th>GPA</th>
                            <th>Status</th>
                            <th>Enrollment Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allStudents.map(student => `
                            <tr>
                                <td>${student.id}</td>
                                <td>${student.firstName} ${student.lastName}</td>
                                <td>${student.email}</td>
                                <td>${student.major}</td>
                                <td>${student.year}</td>
                                <td>${student.gpa.toFixed(2)}</td>
                                <td>${student.status.toUpperCase()}</td>
                                <td>${student.enrollmentDate}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Report Generation Functions for Reports Modal
        function generateEnrollmentReport() {
            const stats = calculateStudentStatistics();
            const reportContent = document.getElementById('reportContent');
            
            reportContent.innerHTML = `
                <h3 style="color: #2c5530; margin-bottom: 20px;">📊 Enrollment Statistics Report</h3>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin-bottom: 30px;">
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <h4 style="color: #2c5530; margin-bottom: 15px;">Total Enrollment</h4>
                        <div style="font-size: 2.5em; font-weight: bold; color: #28a745;">${stats.total}</div>
                        <div style="color: #666;">Total Students</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <h4 style="color: #2c5530; margin-bottom: 15px;">New This Semester</h4>
                        <div style="font-size: 2.5em; font-weight: bold; color: #007bff;">${stats.newSemester}</div>
                        <div style="color: #666;">Recent Enrollments</div>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 25px;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">Enrollment by Status</h4>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #d4edda; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #155724;">${stats.statusBreakdown.active}</div>
                            <div style="color: #155724;">Active</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #856404;">${stats.statusBreakdown.pending}</div>
                            <div style="color: #856404;">Pending</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8d7da; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #721c24;">${stats.statusBreakdown.inactive}</div>
                            <div style="color: #721c24;">Inactive</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #ffeaa7; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #856404;">${stats.statusBreakdown.suspended}</div>
                            <div style="color: #856404;">Suspended</div>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">Enrollment by Academic Year</h4>
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px;">
                        ${Object.entries(stats.yearDistribution).map(([year, count]) => `
                            <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 1.5em; font-weight: bold; color: #2c5530;">${count}</div>
                                <div style="color: #666; font-size: 0.9em;">${year}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateGPAReport() {
            const stats = calculateStudentStatistics();
            const reportContent = document.getElementById('reportContent');
            
            reportContent.innerHTML = `
                <h3 style="color: #2c5530; margin-bottom: 20px;">🎓 GPA Analysis Report</h3>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; margin-bottom: 30px;">
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <h4 style="color: #2c5530; margin-bottom: 15px;">Overall Average GPA</h4>
                        <div style="font-size: 2.5em; font-weight: bold; color: #28a745;">${stats.avgGPA}</div>
                        <div style="color: #666;">Out of 4.0</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <h4 style="color: #2c5530; margin-bottom: 15px;">Success Rate</h4>
                        <div style="font-size: 2.5em; font-weight: bold; color: #007bff;">
                            ${Math.round(((stats.gpaDistribution.excellent + stats.gpaDistribution.good) / stats.total) * 100)}%
                        </div>
                        <div style="color: #666;">Students with 3.0+ GPA</div>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 25px;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">GPA Distribution</h4>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #d4edda; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #155724;">${stats.gpaDistribution.excellent}</div>
                            <div style="color: #155724; font-size: 0.9em;">Excellent (3.7-4.0)</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #cce5ff; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #004085;">${stats.gpaDistribution.good}</div>
                            <div style="color: #004085; font-size: 0.9em;">Good (3.0-3.6)</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #856404;">${stats.gpaDistribution.average}</div>
                            <div style="color: #856404; font-size: 0.9em;">Average (2.5-2.9)</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8d7da; border-radius: 8px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #721c24;">${stats.gpaDistribution.poor}</div>
                            <div style="color: #721c24; font-size: 0.9em;">Below Average (&lt;2.5)</div>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">Top Performing Students</h4>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${allStudents
                            .filter(s => s.gpa >= 3.7)
                            .sort((a, b) => b.gpa - a.gpa)
                            .slice(0, 10)
                            .map(student => `
                                <div style="display: flex; justify-content: space-between; padding: 10px; margin-bottom: 8px; background: #f8f9fa; border-radius: 6px;">
                                    <span><strong>${student.firstName} ${student.lastName}</strong> (${student.id})</span>
                                    <span style="color: #28a745; font-weight: bold;">${student.gpa.toFixed(2)}</span>
                                </div>
                            `).join('')}
                    </div>
                </div>
            `;
        }

        function generateDemographicsReport() {
            const stats = calculateStudentStatistics();
            const reportContent = document.getElementById('reportContent');
            
            reportContent.innerHTML = `
                <h3 style="color: #2c5530; margin-bottom: 20px;">👥 Demographics Report</h3>
                
                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 25px;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">Major Distribution</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        ${Object.entries(stats.majorDistribution).map(([major, count]) => `
                            <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8f9fa; border-radius: 6px;">
                                <span><strong>${major}</strong></span>
                                <span style="color: #007bff; font-weight: bold;">${count} students</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px;">
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <h4 style="color: #2c5530; margin-bottom: 15px;">Most Popular Major</h4>
                        <div style="font-size: 1.5em; font-weight: bold; color: #007bff; margin-bottom: 10px;">
                            ${Object.entries(stats.majorDistribution).sort((a, b) => b[1] - a[1])[0][0]}
                        </div>
                        <div style="color: #666;">
                            ${Object.entries(stats.majorDistribution).sort((a, b) => b[1] - a[1])[0][1]} students enrolled
                        </div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <h4 style="color: #2c5530; margin-bottom: 15px;">Diversity Index</h4>
                        <div style="font-size: 1.5em; font-weight: bold; color: #28a745; margin-bottom: 10px;">
                            ${Object.keys(stats.majorDistribution).length} Programs
                        </div>
                        <div style="color: #666;">Academic programs offered</div>
                    </div>
                </div>
            `;
        }

        function generateMajorDistribution() {
            const stats = calculateStudentStatistics();
            const reportContent = document.getElementById('reportContent');
            
            const sortedMajors = Object.entries(stats.majorDistribution).sort((a, b) => b[1] - a[1]);
            
            reportContent.innerHTML = `
                <h3 style="color: #2c5530; margin-bottom: 20px;">📚 Major Distribution Analysis</h3>
                
                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 25px;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">Enrollment by Major (Ranked)</h4>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${sortedMajors.map(([major, count], index) => {
                            const percentage = ((count / stats.total) * 100).toFixed(1);
                            return `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin-bottom: 10px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid ${['#007bff', '#28a745', '#ffc107', '#dc3545', '#6f42c1', '#17a2b8', '#fd7e14', '#20c997'][index % 8]};">
                                    <div>
                                        <div style="font-weight: bold; font-size: 1.1em;">${major}</div>
                                        <div style="color: #666; font-size: 0.9em;">Rank #${index + 1}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 1.2em; font-weight: bold; color: #2c5530;">${count}</div>
                                        <div style="color: #666; font-size: 0.9em;">${percentage}%</div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">Major Insights</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #e8f5e8; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #155724;">${sortedMajors[0][0]}</div>
                            <div style="color: #155724; font-size: 0.9em;">Most Popular</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #856404;">${sortedMajors[sortedMajors.length - 1][0]}</div>
                            <div style="color: #856404; font-size: 0.9em;">Smallest Program</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #cce5ff; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #004085;">${(stats.total / Object.keys(stats.majorDistribution).length).toFixed(1)}</div>
                            <div style="color: #004085; font-size: 0.9em;">Avg per Major</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateActivityReport() {
            const reportContent = document.getElementById('reportContent');
            
            reportContent.innerHTML = `
                <h3 style="color: #2c5530; margin-bottom: 20px;">📅 Recent Activity Report</h3>
                
                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6; margin-bottom: 25px;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">Recent System Activities</h4>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${activities.map(activity => `
                            <div style="display: flex; align-items: center; padding: 15px; margin-bottom: 10px; background: #f8f9fa; border-radius: 8px;">
                                <div style="font-size: 1.5em; margin-right: 15px;">${activity.icon}</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500;">${activity.text}</div>
                                    <div style="color: #666; font-size: 0.9em;">${activity.time}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">Activity Summary</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #d4edda; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #155724;">${activities.filter(a => a.icon === '🎓').length}</div>
                            <div style="color: #155724; font-size: 0.9em;">Student Activities</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #cce5ff; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #004085;">${activities.filter(a => a.icon === '📧').length}</div>
                            <div style="color: #004085; font-size: 0.9em;">Communications</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #fff3cd; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #856404;">${activities.filter(a => a.icon === '📊').length}</div>
                            <div style="color: #856404; font-size: 0.9em;">Reports Generated</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCustomReport() {
            const reportContent = document.getElementById('reportContent');
            
            reportContent.innerHTML = `
                <h3 style="color: #2c5530; margin-bottom: 20px;">⚙️ Custom Report Builder</h3>
                
                <div style="background: white; padding: 25px; border-radius: 10px; border: 1px solid #dee2e6;">
                    <h4 style="color: #2c5530; margin-bottom: 20px;">Configure Your Custom Report</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: 600;">Report Type</label>
                            <select style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                                <option>Student Summary</option>
                                <option>Academic Performance</option>
                                <option>Enrollment Trends</option>
                                <option>Department Analysis</option>
                                <option>Custom Query</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 10px; font-weight: 600;">Date Range</label>
                            <select style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                                <option>Current Semester</option>
                                <option>Academic Year</option>
                                <option>Last 30 Days</option>
                                <option>Last 6 Months</option>
                                <option>All Time</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600;">Include Fields</label>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                            ${['Student ID', 'Name', 'Email', 'Major', 'GPA', 'Status', 'Enrollment Date', 'Year'].map(field => `
                                <label style="display: flex; align-items: center; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                                    <input type="checkbox" checked style="margin-right: 8px;">
                                    <span>${field}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>

                    <div style="display: flex; justify-content: center; gap: 15px;">
                        <button class="btn btn-primary" onclick="alert('Custom report functionality would generate a report based on selected criteria')">
                            📊 Generate Report
                        </button>
                        <button class="btn btn-secondary" onclick="alert('Custom report would be scheduled for regular generation')">
                            ⏰ Schedule Report
                        </button>
                    </div>
                </div>
            `;
        }

        function setupSearch() {
            const searchInput = document.getElementById('studentSearch');
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const studentItems = document.querySelectorAll('.student-item');
                
                studentItems.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(query)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        }

        // Quick Action functions
        function addStudent() {
            // Use the existing add new student functionality
            addNewStudent();
        }

        function bulkImport() {
            document.getElementById('bulkImportModal').style.display = 'block';
        }

        function generateReports() {
            document.getElementById('reportsModal').style.display = 'block';
        }

        function exportData() {
            const exportOptions = prompt(`💾 Export Student Data
            
Choose export format:
1. CSV (Spreadsheet format)
2. JSON (System integration)
3. PDF (Printable report)
4. Excel (Advanced analysis)

Enter option number (1-4):`);

            if (exportOptions) {
                switch (exportOptions) {
                    case '1':
                        exportStudentsCSV();
                        break;
                    case '2':
                        exportStudentsJSON();
                        break;
                    case '3':
                        exportStudentsPDF();
                        break;
                    case '4':
                        exportStudentsExcel();
                        break;
                    default:
                        alert('Invalid option selected. Please choose 1-4.');
                }
            }
        }

        // Export functions
        function exportStudentsCSV() {
            const csvContent = [
                ['Student ID', 'First Name', 'Last Name', 'Email', 'Phone', 'Major', 'Year', 'GPA', 'Status', 'Enrollment Date', 'Address', 'Emergency Contact'],
                ...allStudents.map(student => [
                    student.id,
                    student.firstName,
                    student.lastName,
                    student.email,
                    student.phone || '',
                    student.major,
                    student.year,
                    student.gpa,
                    student.status,
                    student.enrollmentDate,
                    student.address || '',
                    student.emergencyContact || ''
                ])
            ].map(row => row.join(',')).join('\n');
            
            downloadFile(csvContent, 'waldorf_students.csv', 'text/csv');
            showNotification('✅ Student data exported to CSV successfully!', 'success');
        }

        function exportStudentsJSON() {
            const jsonContent = JSON.stringify(allStudents, null, 2);
            downloadFile(jsonContent, 'waldorf_students.json', 'application/json');
            showNotification('✅ Student data exported to JSON successfully!', 'success');
        }

        function exportStudentsPDF() {
            // Generate a printable PDF report
            const reportHTML = generatePDFReport();
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Waldorf Students Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .summary { background: #f9f9f9; padding: 15px; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    ${reportHTML}
                    <!-- Print function deactivated - user can manually print if needed -->
                    <!-- <script>window.print();</script> -->
                </body>
                </html>
            `);
            showNotification('✅ PDF report opened in new window for printing!', 'success');
        }

        function exportStudentsExcel() {
            // Create Excel-compatible CSV with BOM
            const BOM = '\uFEFF';
            const csvContent = BOM + [
                ['Student ID', 'First Name', 'Last Name', 'Email', 'Phone', 'Major', 'Year', 'GPA', 'Status', 'Enrollment Date', 'Address', 'Emergency Contact'],
                ...allStudents.map(student => [
                    student.id,
                    student.firstName,
                    student.lastName,
                    student.email,
                    student.phone || '',
                    student.major,
                    student.year,
                    student.gpa,
                    student.status,
                    student.enrollmentDate,
                    student.address || '',
                    student.emergencyContact || ''
                ])
            ].map(row => row.join(',')).join('\n');
            
            downloadFile(csvContent, 'waldorf_students.xlsx', 'application/vnd.ms-excel');
            showNotification('✅ Student data exported for Excel successfully!', 'success');
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function generatePDFReport() {
            const now = new Date();
            const totalStudents = allStudents.length;
            const activeStudents = allStudents.filter(s => s.status === 'active').length;
            const avgGPA = (allStudents.reduce((sum, s) => sum + s.gpa, 0) / totalStudents).toFixed(2);

            return `
                <div class="header">
                    <h1>🎓 Waldorf Colleges & Universities</h1>
                    <h2>Student Directory Report</h2>
                    <p>Generated on ${now.toLocaleDateString()} at ${now.toLocaleTimeString()}</p>
                </div>
                
                <div class="summary">
                    <h3>Summary Statistics</h3>
                    <p><strong>Total Students:</strong> ${totalStudents}</p>
                    <p><strong>Active Students:</strong> ${activeStudents}</p>
                    <p><strong>Average GPA:</strong> ${avgGPA}</p>
                    <p><strong>Report Generated By:</strong> Sofia AI Student Management System</p>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Major</th>
                            <th>Year</th>
                            <th>GPA</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allStudents.map(student => `
                            <tr>
                                <td>${student.id}</td>
                                <td>${student.firstName} ${student.lastName}</td>
                                <td>${student.email}</td>
                                <td>${student.major}</td>
                                <td>${student.year}</td>
                                <td>${student.gpa.toFixed(2)}</td>
                                <td>${student.status.toUpperCase()}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Students Database
        let allStudents = [
            {
                id: 'WU001',
                firstName: 'Michael',
                lastName: 'Rodriguez',
                email: 'michael.rodriguez@student.waldorf.edu',
                phone: '+1 (555) 123-4567',
                major: 'Computer Science',
                year: 3,
                gpa: 3.85,
                status: 'active',
                enrollmentDate: '2022-08-15',
                address: '123 Tech Ave, Silicon Valley, CA 94041',
                emergencyContact: 'Maria Rodriguez - (555) 987-6543'
            },
            {
                id: 'WU002',
                firstName: 'Sarah',
                lastName: 'Chen',
                email: 'sarah.chen@student.waldorf.edu',
                phone: '+1 (555) 234-5678',
                major: 'Mathematics',
                year: 2,
                gpa: 3.92,
                status: 'active',
                enrollmentDate: '2023-08-20',
                address: '456 Scholar St, Boston, MA 02115',
                emergencyContact: 'David Chen - (555) 876-5432'
            },
            {
                id: 'WU003',
                firstName: 'James',
                lastName: 'Thompson',
                email: 'james.thompson@student.waldorf.edu',
                phone: '+1 (555) 345-6789',
                major: 'Engineering',
                year: 4,
                gpa: 3.67,
                status: 'active',
                enrollmentDate: '2021-08-25',
                address: '789 Innovation Blvd, Austin, TX 78701',
                emergencyContact: 'Linda Thompson - (555) 765-4321'
            },
            {
                id: 'WU004',
                firstName: 'Emily',
                lastName: 'Davis',
                email: 'emily.davis@student.waldorf.edu',
                phone: '+1 (555) 456-7890',
                major: 'Biology',
                year: 1,
                gpa: 3.45,
                status: 'active',
                enrollmentDate: '2024-08-30',
                address: '321 Science Way, Denver, CO 80202',
                emergencyContact: 'Robert Davis - (555) 654-3210'
            },
            {
                id: 'WU005',
                firstName: 'Alex',
                lastName: 'Kumar',
                email: 'alex.kumar@student.waldorf.edu',
                phone: '+1 (555) 567-8901',
                major: 'Physics',
                year: 2,
                gpa: 3.78,
                status: 'active',
                enrollmentDate: '2023-08-15',
                address: '654 Quantum Lane, Seattle, WA 98101',
                emergencyContact: 'Priya Kumar - (555) 543-2109'
            },
            {
                id: 'WU006',
                firstName: 'Jessica',
                lastName: 'Williams',
                email: 'jessica.williams@student.waldorf.edu',
                phone: '+1 (555) 678-9012',
                major: 'Business',
                year: 3,
                gpa: 3.55,
                status: 'pending',
                enrollmentDate: '2022-08-10',
                address: '987 Commerce St, Miami, FL 33101',
                emergencyContact: 'Mark Williams - (555) 432-1098'
            },
            {
                id: 'WU007',
                firstName: 'David',
                lastName: 'Lee',
                email: 'david.lee@student.waldorf.edu',
                phone: '+1 (555) 789-0123',
                major: 'Liberal Arts',
                year: 4,
                gpa: 3.23,
                status: 'inactive',
                enrollmentDate: '2021-08-12',
                address: '147 Arts Plaza, Portland, OR 97205',
                emergencyContact: 'Susan Lee - (555) 321-0987'
            },
            {
                id: 'WU008',
                firstName: 'Maria',
                lastName: 'Garcia',
                email: 'maria.garcia@student.waldorf.edu',
                phone: '+1 (555) 890-1234',
                major: 'Chemistry',
                year: 1,
                gpa: 3.89,
                status: 'active',
                enrollmentDate: '2024-08-28',
                address: '258 Elements Dr, Phoenix, AZ 85001',
                emergencyContact: 'Carlos Garcia - (555) 210-9876'
            },
            {
                id: 'WU009',
                firstName: 'Ryan',
                lastName: 'Mitchell',
                email: 'ryan.mitchell@student.waldorf.edu',
                phone: '+1 (555) 901-2345',
                major: 'Computer Science',
                year: 2,
                gpa: 2.95,
                status: 'suspended',
                enrollmentDate: '2023-08-22',
                address: '369 Code Blvd, San Francisco, CA 94102',
                emergencyContact: 'Nancy Mitchell - (555) 109-8765'
            },
            {
                id: 'WU010',
                firstName: 'Amanda',
                lastName: 'Taylor',
                email: 'amanda.taylor@student.waldorf.edu',
                phone: '+1 (555) 012-3456',
                major: 'Mathematics',
                year: 5,
                gpa: 3.95,
                status: 'active',
                enrollmentDate: '2020-08-17',
                address: '741 Theory Rd, Chicago, IL 60601',
                emergencyContact: 'Paul Taylor - (555) 098-7654'
            }
        ];

        let filteredStudents = [...allStudents];
        let currentPage = 1;
        let studentsPerPage = 10;
        let currentSort = { field: null, direction: 'asc' };
        let selectedStudents = new Set();
        let editingStudentId = null;

        function viewAllStudents() {
            document.getElementById('studentsTableModal').style.display = 'block';
            loadStudentsTable();
            showNotification('📊 Loading students database...', 'info');
        }

        function addNewStudent() {
            // Open the comprehensive student form
            editingStudentId = null;
            document.getElementById('studentForm').reset();
            document.getElementById('formModalTitle').textContent = '✨ New Student Registration';
            document.getElementById('saveStudentBtn').textContent = 'Register Student';
            
            // Set default enrollment date to today
            document.getElementById('enrollmentDate').value = new Date().toISOString().split('T')[0];
            
            // Set default status to pending for new registrations
            document.getElementById('studentStatus').value = 'pending';
            
            // Auto-generate next student ID
            const nextId = generateNextStudentId();
            document.getElementById('studentId').value = nextId;
            
            document.getElementById('studentFormModal').style.display = 'block';
            showNotification('📝 Opening student registration form...', 'info');
        }

        function generateNextStudentId() {
            // Find the highest existing ID number
            let maxId = 0;
            allStudents.forEach(student => {
                const idNumber = parseInt(student.id.replace('WU', ''));
                if (idNumber > maxId) {
                    maxId = idNumber;
                }
            });
            
            // Return next ID in sequence
            const nextNumber = maxId + 1;
            return `WU${nextNumber.toString().padStart(3, '0')}`;
        }

        function generateEmailAddress() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const emailField = document.getElementById('studentEmail');
            
            if (firstName && lastName && !editingStudentId) {
                // Generate email only for new students, not when editing
                const cleanFirstName = firstName.toLowerCase().replace(/[^a-z]/g, '');
                const cleanLastName = lastName.toLowerCase().replace(/[^a-z]/g, '');
                
                if (cleanFirstName && cleanLastName) {
                    const baseEmail = `${cleanFirstName}.${cleanLastName}@student.waldorf.edu`;
                    
                    // Check if email already exists and add number if needed
                    let emailExists = allStudents.some(student => student.email === baseEmail);
                    let finalEmail = baseEmail;
                    let counter = 1;
                    
                    while (emailExists) {
                        finalEmail = `${cleanFirstName}.${cleanLastName}${counter}@student.waldorf.edu`;
                        emailExists = allStudents.some(student => student.email === finalEmail);
                        counter++;
                    }
                    
                    emailField.value = finalEmail;
                }
            }
        }

        function validateGPA() {
            const gpaInput = document.getElementById('studentGPA');
            const gpa = parseFloat(gpaInput.value);
            
            if (gpa < 0 || gpa > 4) {
                gpaInput.setCustomValidity('GPA must be between 0.0 and 4.0');
            } else {
                gpaInput.setCustomValidity('');
            }
        }

        function formatPhoneNumber(input) {
            // Auto-format phone number as user types
            let value = input.value.replace(/\D/g, '');
            
            if (value.length >= 10) {
                if (value.length === 10) {
                    value = `+1 (${value.slice(0,3)}) ${value.slice(3,6)}-${value.slice(6,10)}`;
                } else if (value.length === 11 && value.startsWith('1')) {
                    value = `+1 (${value.slice(1,4)}) ${value.slice(4,7)}-${value.slice(7,11)}`;
                }
            }
            
            input.value = value;
        }

        function performCustomValidation(formData) {
            const firstName = formData.get('firstName').trim();
            const lastName = formData.get('lastName').trim();
            const email = formData.get('email').trim();
            const studentId = formData.get('studentId').trim();
            const gpa = parseFloat(formData.get('gpa')) || 0;

            // Check for duplicate email (excluding current student if editing)
            const existingEmailStudent = allStudents.find(s => s.email === email && s.id !== editingStudentId);
            if (existingEmailStudent) {
                return {
                    isValid: false,
                    message: `Email address "${email}" is already in use by student ${existingEmailStudent.firstName} ${existingEmailStudent.lastName} (${existingEmailStudent.id}).`
                };
            }

            // Validate name length
            if (firstName.length < 2 || lastName.length < 2) {
                return {
                    isValid: false,
                    message: 'First name and last name must be at least 2 characters long.'
                };
            }

            // Validate GPA range
            if (gpa < 0 || gpa > 4) {
                return {
                    isValid: false,
                    message: 'GPA must be between 0.0 and 4.0.'
                };
            }

            // Validate student ID format
            if (!/^WU\d{3}$/.test(studentId)) {
                return {
                    isValid: false,
                    message: 'Student ID must be in format WU### (e.g., WU001).'
                };
            }

            return { isValid: true };
        }

        function updateFormValidationSummary() {
            const summary = document.getElementById('formValidationSummary');
            const list = document.getElementById('validationList');
            const form = document.getElementById('studentForm');
            
            const requiredFields = [
                { id: 'firstName', label: 'First Name' },
                { id: 'lastName', label: 'Last Name' },
                { id: 'studentEmail', label: 'Email Address' },
                { id: 'studentMajor', label: 'Major' },
                { id: 'studentYear', label: 'Academic Year' },
                { id: 'studentStatus', label: 'Status' }
            ];

            const incompleteFields = [];
            const completedFields = [];

            requiredFields.forEach(field => {
                const input = document.getElementById(field.id);
                if (input && (!input.value || input.value.trim() === '')) {
                    incompleteFields.push(field.label);
                } else {
                    completedFields.push(field.label);
                }
            });

            if (incompleteFields.length > 0) {
                summary.style.display = 'block';
                list.innerHTML = incompleteFields.map(field => 
                    `<li>❌ ${field} - Required</li>`
                ).join('') + completedFields.map(field => 
                    `<li>✅ ${field} - Complete</li>`
                ).join('');
            } else {
                summary.style.display = 'none';
            }
        }

        // Add real-time form validation
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('studentForm');
            if (form) {
                const inputs = form.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.addEventListener('input', updateFormValidationSummary);
                    input.addEventListener('blur', updateFormValidationSummary);
                });
            }
        });

        function advancedSearch() {
            document.getElementById('advancedSearchModal').style.display = 'block';
            setupAdvancedSearchListeners();
        }

        function setupAdvancedSearchListeners() {
            // Real-time search preview
            const searchInputs = [
                'searchStudentId', 'searchFirstName', 'searchLastName', 'searchEmailDomain',
                'searchMajor', 'searchYear', 'searchStatus', 'searchGPARange', 
                'searchEnrollmentPeriod', 'searchFreeText'
            ];

            searchInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.addEventListener('input', updateSearchPreview);
                    input.addEventListener('change', updateSearchPreview);
                }
            });
        }

        function updateSearchPreview() {
            const criteria = getSearchCriteria();
            const matchingStudents = performAdvancedSearchFilter(criteria);
            
            const preview = document.getElementById('searchResultsPreview');
            if (matchingStudents.length === 0) {
                preview.innerHTML = '<span style="color: #dc3545;">No students match the current criteria</span>';
            } else {
                preview.innerHTML = `
                    <span style="color: #28a745; font-weight: 600;">${matchingStudents.length} student(s) found</span>
                    <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        ${matchingStudents.slice(0, 3).map(s => 
                            `• ${s.firstName} ${s.lastName} (${s.id}) - ${s.major}`
                        ).join('<br>')}
                        ${matchingStudents.length > 3 ? `<br>... and ${matchingStudents.length - 3} more` : ''}
                    </div>
                `;
            }
        }

        function getSearchCriteria() {
            return {
                studentId: document.getElementById('searchStudentId').value.trim(),
                firstName: document.getElementById('searchFirstName').value.trim(),
                lastName: document.getElementById('searchLastName').value.trim(),
                emailDomain: document.getElementById('searchEmailDomain').value,
                major: document.getElementById('searchMajor').value,
                year: document.getElementById('searchYear').value,
                status: document.getElementById('searchStatus').value,
                gpaRange: document.getElementById('searchGPARange').value,
                enrollmentPeriod: document.getElementById('searchEnrollmentPeriod').value,
                freeText: document.getElementById('searchFreeText').value.trim().toLowerCase()
            };
        }

        function performAdvancedSearchFilter(criteria) {
            return allStudents.filter(student => {
                // Student ID filter
                if (criteria.studentId && !student.id.toLowerCase().includes(criteria.studentId.toLowerCase())) {
                    return false;
                }

                // Name filters
                if (criteria.firstName && !student.firstName.toLowerCase().includes(criteria.firstName.toLowerCase())) {
                    return false;
                }
                if (criteria.lastName && !student.lastName.toLowerCase().includes(criteria.lastName.toLowerCase())) {
                    return false;
                }

                // Email domain filter
                if (criteria.emailDomain && !student.email.includes(criteria.emailDomain)) {
                    return false;
                }

                // Major filter
                if (criteria.major && student.major !== criteria.major) {
                    return false;
                }

                // Year filter
                if (criteria.year && student.year.toString() !== criteria.year) {
                    return false;
                }

                // Status filter
                if (criteria.status && student.status !== criteria.status) {
                    return false;
                }

                // GPA range filter
                if (criteria.gpaRange) {
                    const gpa = student.gpa;
                    switch (criteria.gpaRange) {
                        case '4.0':
                            if (gpa !== 4.0) return false;
                            break;
                        case '3.7-4.0':
                            if (gpa < 3.7 || gpa > 4.0) return false;
                            break;
                        case '3.0-3.6':
                            if (gpa < 3.0 || gpa > 3.6) return false;
                            break;
                        case '2.5-2.9':
                            if (gpa < 2.5 || gpa > 2.9) return false;
                            break;
                        case '0.0-2.4':
                            if (gpa < 0.0 || gpa > 2.4) return false;
                            break;
                    }
                }

                // Enrollment period filter
                if (criteria.enrollmentPeriod && student.enrollmentDate) {
                    const enrollYear = new Date(student.enrollmentDate).getFullYear();
                    switch (criteria.enrollmentPeriod) {
                        case '2024':
                            if (enrollYear !== 2024) return false;
                            break;
                        case '2023':
                            if (enrollYear !== 2023) return false;
                            break;
                        case '2022':
                            if (enrollYear !== 2022) return false;
                            break;
                        case '2021':
                            if (enrollYear !== 2021) return false;
                            break;
                        case 'older':
                            if (enrollYear >= 2021) return false;
                            break;
                    }
                }

                // Free text search
                if (criteria.freeText) {
                    const searchText = criteria.freeText;
                    const searchableText = [
                        student.address || '',
                        student.emergencyContact || '',
                        student.phone || '',
                        student.email || ''
                    ].join(' ').toLowerCase();
                    
                    if (!searchableText.includes(searchText)) {
                        return false;
                    }
                }

                return true;
            });
        }

        function clearAdvancedSearch() {
            const inputs = [
                'searchStudentId', 'searchFirstName', 'searchLastName', 'searchEmailDomain',
                'searchMajor', 'searchYear', 'searchStatus', 'searchGPARange', 
                'searchEnrollmentPeriod', 'searchFreeText'
            ];

            inputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                if (input) {
                    input.value = '';
                }
            });

            updateSearchPreview();
        }

        function saveSearchPreset() {
            const criteria = getSearchCriteria();
            const name = prompt('Enter a name for this search preset:');
            
            if (name && name.trim()) {
                let searchPresets = JSON.parse(localStorage.getItem('studentSearchPresets') || '[]');
                const preset = {
                    id: Date.now(),
                    name: name.trim(),
                    criteria: criteria,
                    created: new Date().toISOString()
                };
                
                searchPresets.push(preset);
                localStorage.setItem('studentSearchPresets', JSON.stringify(searchPresets));
                
                showNotification(`Search preset "${name}" saved successfully!`, 'success');
            }
        }

        function executeAdvancedSearch() {
            const criteria = getSearchCriteria();
            const results = performAdvancedSearchFilter(criteria);
            
            // Update the main table with search results
            filteredStudents = results;
            currentPage = 1;
            
            // Open the main students table with filtered results
            document.getElementById('studentsTableModal').style.display = 'block';
            renderTable();
            renderPagination();
            
            // Close advanced search modal
            closeAdvancedSearch();
            
            showNotification(`Found ${results.length} student(s) matching your criteria`, 'success');
        }

        function closeAdvancedSearch() {
            document.getElementById('advancedSearchModal').style.display = 'none';
        }

        // Enrollment Workflow Functions
        function openMessage(messageId) {
            const message = inboxMessages.find(msg => msg.id === messageId);
            if (!message) return;
            
            // Mark as read
            message.read = true;
            loadInbox();
            updateCounts();
            
            // Show message details
            alert(`📧 Email from ${message.sender}\n\nSubject: ${message.subject}\n\n${message.fullMessage}`);
        }

        function markAllRead() {
            inboxMessages.forEach(msg => msg.read = true);
            loadInbox();
            updateCounts();
            
            alert('✅ All messages marked as read!');
        }

        function activateStudent(studentId) {
            const student = pendingActivations.find(s => s.id === studentId);
            if (!student) return;
            
            showActivationModal(student);
        }

        function showActivationModal(student) {
            const modal = document.getElementById('activationModal');
            const modalBody = document.getElementById('modalBody');
            
            // Generate login credentials
            const username = student.id.toLowerCase();
            const password = generateSecurePassword();
            const tempPassword = generateTempPassword();
            
            modalBody.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3em; margin-bottom: 10px;">🎓</div>
                    <h3>Activating: ${student.name}</h3>
                    <p style="color: #6c757d;">Student ID: ${student.id}</p>
                </div>
                
                <div class="credential-section">
                    <h4 style="color: #2c5530; margin-bottom: 15px;">🔐 Generated Login Credentials</h4>
                    <div class="credential-item">
                        <span class="credential-label">Username:</span>
                        <span class="credential-value">${username}</span>
                    </div>
                    <div class="credential-item">
                        <span class="credential-label">Temporary Password:</span>
                        <span class="credential-value">${tempPassword}</span>
                    </div>
                    <div class="credential-item">
                        <span class="credential-label">Portal URL:</span>
                        <span class="credential-value">https://portal.waldorf.edu</span>
                    </div>
                    <p style="font-size: 0.9em; color: #6c757d; margin-top: 10px;">
                        * Student must change password on first login
                    </p>
                </div>
                
                <div class="email-preview">
                    <div class="email-header">
                        <div class="email-field"><strong>To:</strong> affairs@waldorf.edu</div>
                        <div class="email-field"><strong>From:</strong> sofia.agent@waldorf.edu</div>
                        <div class="email-field"><strong>Subject:</strong> Student Account Activated - ${student.name} (${student.id})</div>
                    </div>
                    <div class="email-body">
                        <p>Dear Student Affairs Team,</p>
                        
                        <p>I have successfully activated the student account for:</p>
                        
                        <p><strong>Student:</strong> ${student.name}<br>
                        <strong>Student ID:</strong> ${student.id}<br>
                        <strong>Email:</strong> ${student.email}<br>
                        <strong>Major:</strong> ${student.major}</p>
                        
                        <p><strong>Login Credentials:</strong><br>
                        Username: ${username}<br>
                        Temporary Password: ${tempPassword}<br>
                        Portal URL: https://portal.waldorf.edu</p>
                        
                        <p>Please forward these credentials to the student's email address. The student will be required to change their password upon first login.</p>
                        
                        <p>The student now has access to:</p>
                        <ul>
                            <li>Student Portal Dashboard</li>
                            <li>Course Registration</li>
                            <li>Grade Viewing</li>
                            <li>Schedule Management</li>
                            <li>Financial Account Access</li>
                        </ul>
                        
                        <p>Best regards,<br>
                        Sofia - Student Management Agent<br>
                        Waldorf Colleges & Universities</p>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                    <button class="btn btn-activate" onclick="confirmActivation('${student.id}', '${username}', '${tempPassword}')">
                        ✅ Confirm Activation & Send Email
                    </button>
                    <button class="btn btn-secondary" onclick="closeActivationModal()">
                        Cancel
                    </button>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function confirmActivation(studentId, username, password) {
            const student = pendingActivations.find(s => s.id === studentId);
            if (!student) return;
            
            // Move student to active list
            const newStudent = {
                id: student.id,
                name: student.name,
                email: student.email,
                major: student.major,
                year: student.year,
                gpa: 0.0, // New student starts with 0.0 GPA
                status: 'active'
            };
            
            students.push(newStudent);
            
            // Remove from pending list
            const index = pendingActivations.findIndex(s => s.id === studentId);
            if (index > -1) {
                pendingActivations.splice(index, 1);
            }
            
            // Add activity
            activities.unshift({
                icon: '✅',
                text: `Activated student account for ${student.name}`,
                time: 'Just now'
            });
            
            // Simulate sending email to Student Affairs
            setTimeout(() => {
                alert(`📧 Email Sent Successfully!\n\nLogin credentials for ${student.name} have been sent to Student Affairs.\n\nThey will forward the information to:\n${student.email}\n\nThe student can now access the portal at:\nhttps://portal.waldorf.edu`);
                
                // Close modal and refresh
                closeActivationModal();
                initializePage();
            }, 1000);
        }

        function generateSecurePassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
            let password = '';
            for (let i = 0; i < 12; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }

        function generateTempPassword() {
            // Generate a simple, memorable temporary password
            const adjectives = ['Blue', 'Red', 'Green', 'Swift', 'Bright', 'Quick', 'Silver', 'Golden', 'Cosmic', 'Electric'];
            const nouns = ['Tiger', 'Eagle', 'River', 'Mountain', 'Star', 'Ocean', 'Phoenix', 'Thunder', 'Crystal', 'Storm'];
            const numbers = Math.floor(Math.random() * 99) + 10;
            
            return adjectives[Math.floor(Math.random() * adjectives.length)] + 
                   nouns[Math.floor(Math.random() * nouns.length)] + 
                   numbers;
        }

        function sendStudentActivationNotification(studentData, username, tempPassword) {
            // Generate unique message ID
            const messageId = inboxMessages.length + 1;
            
            // Also sync with Student Affairs Portal
            syncWithStudentAffairs(studentData, username, tempPassword);
            
            // Create notification message for Student Affairs
            const notificationMessage = {
                id: messageId,
                sender: 'Sofia AI - Student Management',
                senderEmail: 'sofia.agent@waldorf.edu',
                subject: `✅ Student Account Activated - ${studentData.firstName} ${studentData.lastName} (${studentData.id})`,
                preview: `Account activated for ${studentData.firstName} ${studentData.lastName}. Student can now login and change credentials...`,
                time: 'Just now',
                read: false,
                studentId: studentData.id,
                fullMessage: `Dear Student Affairs Team,

I have successfully processed and activated a new student account:

📋 STUDENT INFORMATION:
• Name: ${studentData.firstName} ${studentData.lastName}
• Student ID: ${studentData.id}
• Email: ${studentData.email}
• Phone: ${studentData.phone || 'Not provided'}
• Major: ${studentData.major}
• Academic Year: Year ${studentData.year}
• Current GPA: ${studentData.gpa ? studentData.gpa.toFixed(2) : 'Not yet assigned'}
• Status: ${studentData.status.toUpperCase()}
• Enrollment Date: ${studentData.enrollmentDate}

🔐 LOGIN CREDENTIALS:
• Username: ${username}
• Temporary Password: ${tempPassword}
• Portal URL: https://portal.waldorf.edu

📋 NEXT STEPS:
1. Please forward these login credentials to the student's email address: ${studentData.email}
2. Inform the student that they MUST change their password on first login
3. The student will have access to:
   - Student Portal Dashboard
   - Course Registration System
   - Grade Viewing
   - Schedule Management
   - Financial Account Information

⚠️ IMPORTANT SECURITY NOTES:
• The temporary password expires after first use
• Student must create a new secure password (min 8 characters)
• Two-factor authentication is recommended
• Account security guidelines will be provided upon login

The student account is now fully active and ready for use. Please ensure the student receives these credentials promptly so they can begin accessing university services.

If you have any questions or need additional assistance, please don't hesitate to contact me.

Best regards,
Sofia - AI Student Management Agent
Waldorf Colleges & Universities
📧 sofia.agent@waldorf.edu`
            };

            // Add to inbox messages
            inboxMessages.unshift(notificationMessage);
            
            // Update inbox badge count immediately
            const unreadCount = inboxMessages.filter(msg => !msg.read).length;
            const inboxBadge = document.getElementById('inboxBadge');
            if (inboxBadge) {
                inboxBadge.textContent = unreadCount;
                // Add visual emphasis to show new message
                inboxBadge.style.animation = 'pulse 1s ease-in-out 3';
            }
            
            // Show immediate notification
            showNotification('📧 Student Affairs has been notified of the account activation', 'info');
        }

        function showStudentRegistrationSummary(studentData, username, tempPassword) {
            const summaryModal = document.createElement('div');
            summaryModal.className = 'activation-modal';
            summaryModal.id = 'registrationSummary';
            summaryModal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                        <h2 class="modal-title">🎉 Student Registration Complete!</h2>
                        <button class="close-btn" onclick="closeRegistrationSummary()">&times;</button>
                    </div>
                    
                    <div style="padding: 30px; text-align: center;">
                        <div style="font-size: 4em; margin-bottom: 20px;">✅</div>
                        <h3 style="color: #28a745; margin-bottom: 25px;">Successfully Registered: ${studentData.firstName} ${studentData.lastName}</h3>
                        
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 25px; margin: 20px 0;">
                            <h4 style="color: #2c5530; margin-bottom: 15px;">🔐 Generated Login Credentials</h4>
                            <div style="background: white; border-radius: 8px; padding: 20px; margin: 15px 0;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: left;">
                                    <div>
                                        <strong>Student ID:</strong><br>
                                        <code style="background: #e9ecef; padding: 5px 8px; border-radius: 4px;">${studentData.id}</code>
                                    </div>
                                    <div>
                                        <strong>Username:</strong><br>
                                        <code style="background: #e9ecef; padding: 5px 8px; border-radius: 4px;">${username}</code>
                                    </div>
                                    <div>
                                        <strong>Temporary Password:</strong><br>
                                        <code style="background: #fff3cd; padding: 5px 8px; border-radius: 4px; color: #856404;">${tempPassword}</code>
                                    </div>
                                    <div>
                                        <strong>Portal URL:</strong><br>
                                        <code style="background: #e9ecef; padding: 5px 8px; border-radius: 4px;">portal.waldorf.edu</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 8px; padding: 20px; margin: 20px 0;">
                            <h5 style="color: #0c5460; margin-bottom: 15px;">📧 Student Affairs Notification</h5>
                            <p style="color: #0c5460; margin: 0;">
                                Student Affairs has been automatically notified with the account details. 
                                They will forward the login credentials to <strong>${studentData.email}</strong>.
                            </p>
                        </div>
                        
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; margin: 20px 0;">
                            <h5 style="color: #856404; margin-bottom: 15px;">⚠️ Important Security Instructions</h5>
                            <ul style="color: #856404; text-align: left; margin: 0;">
                                <li>Student must change password on first login</li>
                                <li>Temporary password expires after first use</li>
                                <li>Two-factor authentication will be set up during first login</li>
                                <li>Account includes access to all university services</li>
                            </ul>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <button class="btn btn-success" onclick="closeRegistrationSummary()" style="padding: 12px 30px; font-size: 16px;">
                                ✅ Complete Registration
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(summaryModal);
            summaryModal.style.display = 'block';
        }

        function closeRegistrationSummary() {
            const summary = document.getElementById('registrationSummary');
            if (summary) {
                summary.remove();
            }
        }

        // Cross-system communication with Student Affairs Portal
        function syncWithStudentAffairs(studentData, username, tempPassword) {
            // Simulate real-time sync with Student Affairs Portal
            const studentAffairsData = {
                id: studentData.id,
                name: `${studentData.firstName} ${studentData.lastName}`,
                email: studentData.email,
                major: studentData.major,
                year: studentData.year,
                status: 'active',
                activatedTime: 'Just now',
                credentialsSent: false,
                credentials: {
                    username: username,
                    tempPassword: tempPassword
                }
            };

            // Store in localStorage for Student Affairs Portal to access
            let studentAffairsStudents = JSON.parse(localStorage.getItem('studentAffairsActiveStudents') || '[]');
            studentAffairsStudents.unshift(studentAffairsData);
            localStorage.setItem('studentAffairsActiveStudents', JSON.stringify(studentAffairsStudents));

            // Store Sofia message for Student Affairs
            const sofiaMessage = {
                id: Date.now(),
                sender: 'Sofia AI - Student Management',
                subject: `✅ Student Account Activated - ${studentData.firstName} ${studentData.lastName} (${studentData.id})`,
                preview: `Account activated for ${studentData.firstName} ${studentData.lastName}. Student can now login and change credentials...`,
                time: 'Just now',
                read: false,
                studentData: studentAffairsData,
                fullMessage: generateSofiaMessage(studentData, username, tempPassword)
            };

            let sofiaMessages = JSON.parse(localStorage.getItem('sofiaMessages') || '[]');
            sofiaMessages.unshift(sofiaMessage);
            localStorage.setItem('sofiaMessages', JSON.stringify(sofiaMessages));

            // Update statistics
            updateStudentAffairsStats();
        }

        function generateSofiaMessage(studentData, username, tempPassword) {
            return `Dear Student Affairs Team,

I have successfully processed and activated a new student account:

📋 STUDENT INFORMATION:
• Name: ${studentData.firstName} ${studentData.lastName}
• Student ID: ${studentData.id}
• Email: ${studentData.email}
• Phone: ${studentData.phone || 'Not provided'}
• Major: ${studentData.major}
• Academic Year: Year ${studentData.year}
• Current GPA: ${studentData.gpa ? studentData.gpa.toFixed(2) : 'Not yet assigned'}
• Status: ${studentData.status.toUpperCase()}
• Enrollment Date: ${studentData.enrollmentDate}

🔐 LOGIN CREDENTIALS:
• Username: ${username}
• Temporary Password: ${tempPassword}
• Portal URL: https://portal.waldorf.edu

📋 NEXT STEPS:
1. Please forward these login credentials to the student's email address: ${studentData.email}
2. Inform the student that they MUST change their password on first login
3. The student will have access to:
   - Student Portal Dashboard
   - Course Registration System
   - Grade Viewing
   - Schedule Management
   - Financial Account Information

⚠️ IMPORTANT SECURITY NOTES:
• The temporary password expires after first use
• Student must create a new secure password (min 8 characters)
• Two-factor authentication is recommended
• Account security guidelines will be provided upon login

The student account is now fully active and ready for use. Please ensure the student receives these credentials promptly so they can begin accessing university services.

If you have any questions or need additional assistance, please don't hesitate to contact me.

Best regards,
Sofia - AI Student Management Agent
Waldorf Colleges & Universities
📧 sofia.agent@waldorf.edu`;
        }

        function updateStudentAffairsStats() {
            // Update localStorage stats for Student Affairs Portal
            const stats = {
                newRegistrations: JSON.parse(localStorage.getItem('sofiaMessages') || '[]').length,
                credentialsSent: JSON.parse(localStorage.getItem('studentAffairsActiveStudents') || '[]').filter(s => s.credentialsSent).length,
                pendingActivations: pendingActivations.length,
                activatedToday: JSON.parse(localStorage.getItem('studentAffairsActiveStudents') || '[]').length,
                lastUpdate: new Date().toISOString()
            };
            localStorage.setItem('studentAffairsStats', JSON.stringify(stats));
        }

        // Load Student Affairs data if available
        function loadStudentAffairsData() {
            // Check if there are any pending requests from Student Affairs
            const pendingRequests = JSON.parse(localStorage.getItem('studentAffairsPendingRequests') || '[]');
            
            if (pendingRequests.length > 0) {
                // Process pending activation requests
                pendingRequests.forEach(request => {
                    if (!allStudents.find(s => s.id === request.id)) {
                        // Add student to pending activations if not already processed
                        const pendingStudent = {
                            id: request.id,
                            name: request.name,
                            email: request.email,
                            major: request.major,
                            year: request.year,
                            enrollmentDate: request.enrollmentDate || new Date().toISOString().split('T')[0],
                            phone: request.phone || '',
                            address: request.address || '',
                            emergencyContact: request.emergencyContact || '',
                            status: 'pending_activation'
                        };
                        
                        pendingActivations.push(pendingStudent);
                    }
                });
                
                // Clear processed requests
                localStorage.removeItem('studentAffairsPendingRequests');
                
                // Refresh displays
                if (typeof loadPendingActivations === 'function') {
                    loadPendingActivations();
                    updateCounts();
                }
                
                showNotification(`📋 ${pendingRequests.length} activation request(s) received from Student Affairs`, 'info');
            }
        }

        // Integration helpers
        function notifyStudentAffairsPortal(message, type = 'info') {
            // Send real-time notifications to Student Affairs Portal
            const notification = {
                id: Date.now(),
                message: message,
                type: type,
                timestamp: new Date().toISOString(),
                from: 'Sofia AI'
            };
            
            let notifications = JSON.parse(localStorage.getItem('studentAffairsNotifications') || '[]');
            notifications.unshift(notification);
            // Keep only last 50 notifications
            notifications = notifications.slice(0, 50);
            localStorage.setItem('studentAffairsNotifications', JSON.stringify(notifications));
        }

        // Auto-sync with Student Affairs Portal every 15 seconds
        setInterval(() => {
            loadStudentAffairsData();
            updateStudentAffairsStats();
        }, 15000);

        function closeActivationModal() {
            document.getElementById('activationModal').style.display = 'none';
        }

        function viewStudentDetails(studentId) {
            const student = pendingActivations.find(s => s.id === studentId);
            if (!student) return;
            
            alert(`👤 Student Details\n\nName: ${student.name}\nStudent ID: ${student.id}\nEmail: ${student.email}\nMajor: ${student.major}\nYear: ${student.year}\nEnrollment Date: ${student.enrollmentDate}\nPhone: ${student.phone}\nAddress: ${student.address}\nEmergency Contact: ${student.emergencyContact}`);
        }

        function rejectActivation(studentId) {
            const student = pendingActivations.find(s => s.id === studentId);
            if (!student) return;
            
            if (confirm(`Are you sure you want to reject the activation for ${student.name}?\n\nThis will require Student Affairs to resubmit the enrollment.`)) {
                // Remove from pending list
                const index = pendingActivations.findIndex(s => s.id === studentId);
                if (index > -1) {
                    pendingActivations.splice(index, 1);
                }
                
                // Add activity
                activities.unshift({
                    icon: '❌',
                    text: `Rejected activation for ${student.name}`,
                    time: 'Just now'
                });
                
                alert(`📧 Rejection Notice Sent\n\nStudent Affairs has been notified that ${student.name}'s activation was rejected.\n\nReason: Requires additional documentation review.`);
                
                initializePage();
            }
        }

        function chatWithSofia() {
            alert('🤖 Chat with Sofia - Student Management Agent\n\n"Hello! I\'m Sofia, your AI assistant. I can help you with:\n\n• Processing pending enrollments\n• Activating student accounts\n• Generating login credentials\n• Coordinating with Student Affairs\n• Managing the enrollment workflow\n\nI see you have ' + pendingActivations.length + ' students pending activation. Would you like me to help process them?"');
        }

        function showHelp() {
            alert('❓ Student Management Help\n\n• Check Sofia\'s inbox for enrollment notifications\n• Activate pending students from Student Affairs\n• Generated credentials are automatically sent back\n• Use the search bar to find active students\n• Sofia handles the complete enrollment workflow');
        }

        function showSettings() {
            alert('⚙️ Student Management Settings\n\n• Configure enrollment workflow\n• Set password complexity requirements\n• Manage email templates\n• Set up automatic notifications\n• Customize activation process');
        }

        // Students Table CRUD Functions
        function loadStudentsTable() {
            applyFilters();
            renderTable();
            renderPagination();
        }

        function applyFilters() {
            const searchTerm = document.getElementById('tableSearchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const majorFilter = document.getElementById('majorFilter').value;

            filteredStudents = allStudents.filter(student => {
                const matchesSearch = !searchTerm || 
                    student.id.toLowerCase().includes(searchTerm) ||
                    `${student.firstName} ${student.lastName}`.toLowerCase().includes(searchTerm) ||
                    student.email.toLowerCase().includes(searchTerm) ||
                    student.major.toLowerCase().includes(searchTerm);

                const matchesStatus = !statusFilter || student.status === statusFilter;
                const matchesMajor = !majorFilter || student.major === majorFilter;

                return matchesSearch && matchesStatus && matchesMajor;
            });

            // Apply sorting
            if (currentSort.field) {
                sortStudents(currentSort.field, currentSort.direction);
            }

            currentPage = 1; // Reset to first page when filtering
        }

        function renderTable() {
            const tbody = document.getElementById('studentsTableBody');
            const startIndex = (currentPage - 1) * studentsPerPage;
            const endIndex = startIndex + studentsPerPage;
            const pageStudents = filteredStudents.slice(startIndex, endIndex);

            tbody.innerHTML = '';

            pageStudents.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="student-checkbox" value="${student.id}" 
                               onchange="updateSelection()" ${selectedStudents.has(student.id) ? 'checked' : ''}>
                    </td>
                    <td>
                        <div class="student-avatar-small">
                            ${student.firstName[0]}${student.lastName[0]}
                        </div>
                    </td>
                    <td><strong>${student.id}</strong></td>
                    <td>${student.firstName} ${student.lastName}</td>
                    <td><a href="mailto:${student.email}">${student.email}</a></td>
                    <td>${student.major}</td>
                    <td>Year ${student.year}</td>
                    <td>
                        <div class="gpa-badge ${getGPAClass(student.gpa)}">
                            ${student.gpa.toFixed(2)}
                        </div>
                    </td>
                    <td>
                        <div class="status-badge status-${student.status}">
                            ${student.status}
                        </div>
                    </td>
                    <td>
                        <div class="action-icons">
                            <button class="action-icon view" onclick="viewStudent('${student.id}')" title="View Details">
                                👁️
                            </button>
                            <button class="action-icon edit" onclick="editStudent('${student.id}')" title="Edit Student">
                                ✏️
                            </button>
                            <button class="action-icon delete" onclick="deleteStudent('${student.id}')" title="Delete Student">
                                🗑️
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getGPAClass(gpa) {
            if (gpa >= 3.7) return 'gpa-excellent';
            if (gpa >= 3.0) return 'gpa-good';
            if (gpa >= 2.5) return 'gpa-average';
            return 'gpa-poor';
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredStudents.length / studentsPerPage);
            const startIndex = (currentPage - 1) * studentsPerPage + 1;
            const endIndex = Math.min(currentPage * studentsPerPage, filteredStudents.length);

            // Update pagination info
            document.getElementById('paginationInfo').textContent = 
                `Showing ${startIndex}-${endIndex} of ${filteredStudents.length} students`;

            // Update pagination controls
            const controls = document.getElementById('paginationControls');
            controls.innerHTML = '';

            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.textContent = '‹ Previous';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => changePage(currentPage - 1);
            controls.appendChild(prevBtn);

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.onclick = () => changePage(i);
                    controls.appendChild(pageBtn);
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '8px 4px';
                    controls.appendChild(ellipsis);
                }
            }

            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.textContent = 'Next ›';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => changePage(currentPage + 1);
            controls.appendChild(nextBtn);
        }

        function changePage(page) {
            currentPage = page;
            renderTable();
            renderPagination();
        }

        function sortTable(field) {
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = 'asc';
            }
            
            sortStudents(field, currentSort.direction);
            renderTable();
        }

        function sortStudents(field, direction) {
            filteredStudents.sort((a, b) => {
                let aVal, bVal;
                
                switch (field) {
                    case 'name':
                        aVal = `${a.firstName} ${a.lastName}`;
                        bVal = `${b.firstName} ${b.lastName}`;
                        break;
                    case 'gpa':
                    case 'year':
                        aVal = parseFloat(a[field]);
                        bVal = parseFloat(b[field]);
                        break;
                    default:
                        aVal = a[field];
                        bVal = b[field];
                }

                if (aVal < bVal) return direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return direction === 'asc' ? 1 : -1;
                return 0;
            });
        }

        function filterStudents() {
            applyFilters();
            renderTable();
            renderPagination();
        }

        // Selection functions
        function updateSelection() {
            const checkboxes = document.querySelectorAll('.student-checkbox');
            selectedStudents.clear();
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedStudents.add(checkbox.value);
                }
            });

            updateBulkActionsVisibility();
            updateSelectAllCheckbox();
        }

        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.student-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateSelection();
        }

        function updateBulkActionsVisibility() {
            const bulkActions = document.getElementById('bulkActions');
            const selectedCount = document.getElementById('selectedCount');
            
            selectedCount.textContent = selectedStudents.size;
            
            if (selectedStudents.size > 0) {
                bulkActions.classList.add('show');
            } else {
                bulkActions.classList.remove('show');
            }
        }

        function updateSelectAllCheckbox() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.student-checkbox');
            const checkedBoxes = document.querySelectorAll('.student-checkbox:checked');
            
            if (checkedBoxes.length === 0) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = false;
            } else if (checkedBoxes.length === checkboxes.length) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = true;
            } else {
                selectAllCheckbox.indeterminate = true;
            }
        }

        function clearSelection() {
            selectedStudents.clear();
            document.querySelectorAll('.student-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('selectAll').checked = false;
            updateBulkActionsVisibility();
        }

        // CRUD Operations
        function viewStudent(studentId) {
            const student = allStudents.find(s => s.id === studentId);
            if (!student) return;

            alert(`👤 Student Profile: ${student.firstName} ${student.lastName}

🆔 Student ID: ${student.id}
📧 Email: ${student.email}
📞 Phone: ${student.phone}
🎓 Major: ${student.major}
📚 Academic Year: ${student.year}
📊 GPA: ${student.gpa.toFixed(2)}
📅 Enrollment Date: ${student.enrollmentDate}
🏠 Address: ${student.address}
🚨 Emergency Contact: ${student.emergencyContact}
📈 Status: ${student.status.toUpperCase()}`);
        }

        function editStudent(studentId) {
            const student = allStudents.find(s => s.id === studentId);
            if (!student) return;

            editingStudentId = studentId;
            populateStudentForm(student);
            document.getElementById('formModalTitle').textContent = 'Edit Student';
            document.getElementById('saveStudentBtn').textContent = 'Update Student';
            document.getElementById('studentFormModal').style.display = 'block';
        }

        function deleteStudent(studentId) {
            const student = allStudents.find(s => s.id === studentId);
            if (!student) return;

            if (confirm(`⚠️ Delete Student\n\nAre you sure you want to delete ${student.firstName} ${student.lastName}?\n\nThis action cannot be undone.`)) {
                const index = allStudents.findIndex(s => s.id === studentId);
                if (index > -1) {
                    allStudents.splice(index, 1);
                    selectedStudents.delete(studentId);
                    loadStudentsTable();
                    showNotification(`Student ${student.firstName} ${student.lastName} has been deleted.`, 'success');
                }
            }
        }

        function openStudentForm(mode) {
            editingStudentId = null;
            document.getElementById('studentForm').reset();
            document.getElementById('formModalTitle').textContent = 'Add New Student';
            document.getElementById('saveStudentBtn').textContent = 'Save Student';
            
            // Set default enrollment date to today
            document.getElementById('enrollmentDate').value = new Date().toISOString().split('T')[0];
            
            document.getElementById('studentFormModal').style.display = 'block';
        }

        function populateStudentForm(student) {
            document.getElementById('studentId').value = student.id;
            document.getElementById('firstName').value = student.firstName;
            document.getElementById('lastName').value = student.lastName;
            document.getElementById('studentEmail').value = student.email;
            document.getElementById('studentPhone').value = student.phone;
            document.getElementById('studentMajor').value = student.major;
            document.getElementById('studentYear').value = student.year;
            document.getElementById('studentGPA').value = student.gpa;
            document.getElementById('studentStatus').value = student.status;
            document.getElementById('enrollmentDate').value = student.enrollmentDate;
            document.getElementById('studentAddress').value = student.address;
            document.getElementById('emergencyContact').value = student.emergencyContact;
        }

        function saveStudent() {
            const form = document.getElementById('studentForm');
            const formData = new FormData(form);
            
            // Show loading state
            const saveBtn = document.getElementById('saveStudentBtn');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = '⏳ Saving...';
            saveBtn.disabled = true;
            
            // Validate form
            if (!form.checkValidity()) {
                form.reportValidity();
                updateFormValidationSummary();
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
                return;
            }

            // Additional custom validation
            const customValidation = performCustomValidation(formData);
            if (!customValidation.isValid) {
                alert(`❌ Validation Error\n\n${customValidation.message}`);
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
                return;
            }

            const studentData = {
                id: formData.get('studentId'),
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                major: formData.get('major'),
                year: parseInt(formData.get('year')),
                gpa: parseFloat(formData.get('gpa')) || 0.0,
                status: formData.get('status'),
                enrollmentDate: formData.get('enrollmentDate'),
                address: formData.get('address'),
                emergencyContact: formData.get('emergencyContact')
            };

            if (editingStudentId) {
                // Update existing student
                const index = allStudents.findIndex(s => s.id === editingStudentId);
                if (index > -1) {
                    allStudents[index] = studentData;
                    
                    // Also update in main students list if exists
                    const mainIndex = students.findIndex(s => s.id === editingStudentId);
                    if (mainIndex > -1) {
                        students[mainIndex] = {
                            id: studentData.id,
                            name: `${studentData.firstName} ${studentData.lastName}`,
                            email: studentData.email,
                            major: studentData.major,
                            year: studentData.year,
                            gpa: studentData.gpa,
                            status: studentData.status
                        };
                    }
                    
                    showNotification(`✅ Student ${studentData.firstName} ${studentData.lastName} has been updated.`, 'success');
                }
            } else {
                // Add new student
                if (allStudents.find(s => s.id === studentData.id)) {
                    alert('❌ Error: Student ID already exists. Please use a different ID.');
                    return;
                }
                
                allStudents.push(studentData);
                
                // Also add to main students list for dashboard
                const newMainStudent = {
                    id: studentData.id,
                    name: `${studentData.firstName} ${studentData.lastName}`,
                    email: studentData.email,
                    major: studentData.major,
                    year: studentData.year,
                    gpa: studentData.gpa,
                    status: studentData.status
                };
                students.push(newMainStudent);
                
                // Generate temporary login credentials
                const tempUsername = studentData.id.toLowerCase();
                const tempPassword = generateTempPassword();
                
                // Send notification to Student Affairs Office
                sendStudentActivationNotification(studentData, tempUsername, tempPassword);
                
                // Add to recent activities
                activities.unshift({
                    icon: '🎓',
                    text: `New student registered: ${studentData.firstName} ${studentData.lastName}`,
                    time: 'Just now'
                });
                
                activities.unshift({
                    icon: '📧',
                    text: `Student Affairs notified - ${studentData.firstName} ${studentData.lastName} account active`,
                    time: 'Just now'
                });
                
                // Refresh main dashboard if on main page
                if (typeof loadStudents === 'function') {
                    loadStudents();
                    loadActivities();
                    loadInbox(); // Refresh inbox to show new notification
                    updateCounts();
                }
                
                showNotification(`🎉 Student ${studentData.firstName} ${studentData.lastName} has been successfully registered!`, 'success');
                
                // Show success summary with login details
                setTimeout(() => {
                    showStudentRegistrationSummary(studentData, tempUsername, tempPassword);
                }, 1000);
            }

            // Restore button state
            saveBtn.textContent = originalText;
            saveBtn.disabled = false;
            
            closeStudentForm();
            loadStudentsTable();
        }

        function closeStudentForm() {
            document.getElementById('studentFormModal').style.display = 'none';
            document.getElementById('formValidationSummary').style.display = 'none';
            editingStudentId = null;
            
            // Reset button state in case it was in loading state
            const saveBtn = document.getElementById('saveStudentBtn');
            saveBtn.disabled = false;
            if (saveBtn.textContent.includes('⏳')) {
                saveBtn.textContent = 'Save Student';
            }
        }

        function closeStudentsTable() {
            document.getElementById('studentsTableModal').style.display = 'none';
            clearSelection();
        }

        // Bulk Operations
        function bulkEdit() {
            if (selectedStudents.size === 0) return;
            
            const selectedCount = selectedStudents.size;
            const operation = prompt(`🔧 Bulk Edit ${selectedCount} Students\n\nChoose operation:\n1. Change Status\n2. Change Major\n3. Update Year\n\nEnter operation number (1-3):`);
            
            if (!operation) return;
            
            let newValue, field;
            
            switch (operation) {
                case '1':
                    newValue = prompt('Enter new status:\n1. active\n2. inactive\n3. pending\n4. suspended');
                    field = 'status';
                    break;
                case '2':
                    newValue = prompt('Enter new major:');
                    field = 'major';
                    break;
                case '3':
                    newValue = parseInt(prompt('Enter new academic year (1-5):'));
                    field = 'year';
                    break;
                default:
                    alert('Invalid operation selected.');
                    return;
            }
            
            if (newValue === null) return;
            
            if (confirm(`Update ${field} to "${newValue}" for ${selectedCount} selected students?`)) {
                selectedStudents.forEach(studentId => {
                    const student = allStudents.find(s => s.id === studentId);
                    if (student) {
                        student[field] = newValue;
                    }
                });
                
                clearSelection();
                loadStudentsTable();
                showNotification(`${selectedCount} students updated successfully.`, 'success');
            }
        }

        function bulkDelete() {
            if (selectedStudents.size === 0) return;
            
            const selectedCount = selectedStudents.size;
            
            if (confirm(`⚠️ Delete ${selectedCount} Students\n\nAre you sure you want to delete all selected students?\n\nThis action cannot be undone.`)) {
                const selectedIds = Array.from(selectedStudents);
                selectedIds.forEach(studentId => {
                    const index = allStudents.findIndex(s => s.id === studentId);
                    if (index > -1) {
                        allStudents.splice(index, 1);
                    }
                });
                
                clearSelection();
                loadStudentsTable();
                showNotification(`${selectedCount} students deleted successfully.`, 'success');
            }
        }

        function exportStudents() {
            const csvContent = [
                ['Student ID', 'First Name', 'Last Name', 'Email', 'Phone', 'Major', 'Year', 'GPA', 'Status', 'Enrollment Date', 'Address', 'Emergency Contact'],
                ...filteredStudents.map(student => [
                    student.id,
                    student.firstName,
                    student.lastName,
                    student.email,
                    student.phone,
                    student.major,
                    student.year,
                    student.gpa,
                    student.status,
                    student.enrollmentDate,
                    student.address,
                    student.emergencyContact
                ])
            ].map(row => row.join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'waldorf_students.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Students data exported successfully!', 'success');
        }

        function bulkImportStudents() {
            alert('📁 Bulk Import Students\n\nThis feature would allow you to:\n• Upload CSV or Excel files\n• Map columns to student fields\n• Validate data before import\n• Handle duplicate records\n• Preview import results\n\nSupported formats: CSV, Excel (.xlsx), JSON');
        }

        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('tableSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    filterStudents();
                });
            }
        });

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()">&times;</button>
            `;
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#cce5ff'};
                color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#004085'};
                border: 1px solid ${type === 'success' ? '#c3e6cb' : type === 'error' ? '#f5c6cb' : '#b3d7ff'};
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 10000;
                max-width: 400px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 10px;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Initialize page when loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            loadStudentAffairsData(); // Check for Student Affairs requests on startup
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const activationModal = document.getElementById('activationModal');
            const studentsModal = document.getElementById('studentsTableModal');
            const formModal = document.getElementById('studentFormModal');
            const summaryModal = document.getElementById('registrationSummary');
            const statisticsModal = document.getElementById('statisticsModal');
            const advancedSearchModal = document.getElementById('advancedSearchModal');
            const bulkImportModal = document.getElementById('bulkImportModal');
            const reportsModal = document.getElementById('reportsModal');
            
            if (event.target == activationModal) {
                closeActivationModal();
            } else if (event.target == studentsModal) {
                closeStudentsTable();
            } else if (event.target == formModal) {
                closeStudentForm();
            } else if (event.target == summaryModal) {
                closeRegistrationSummary();
            } else if (event.target == statisticsModal) {
                closeStatisticsModal();
            } else if (event.target == advancedSearchModal) {
                closeAdvancedSearch();
            } else if (event.target == bulkImportModal) {
                closeBulkImportModal();
            } else if (event.target == reportsModal) {
                closeReportsModal();
            }
        }
    </script>
</body>
</html> 